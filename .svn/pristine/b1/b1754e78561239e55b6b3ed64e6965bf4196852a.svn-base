package com.ucf.customer.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.ucf.customer.dao.UcfDistrictDao;

/**
 * 省市地区级联数据服务
 * Description: 
 * All Rights Reserved.
 * @version 1.0  2014-3-14 下午3:48:53  by WangYanCheng（wangyancheng@ucfgroup.com）创建
 */
@Service("provinceService")
public class ProvinceService {
	/**给前端Json用的数组标记_Begin*/
	private String PROVINCE_TAG = "province";
	private String CITY_TAG = "city";
	private String DISTRICT_TAG = "district";
	/**给前端Json用的数组标记_End*/
	@Autowired
	private UcfDistrictDao ucfDistrictDao;
	/**
	 * 查省市地区码基础数据
	 * Description: 
	 * @Version1.0 2014-3-14 下午3:49:17 by WangYanCheng（wangyancheng@ucfgroup.com）创建
	 * @return rtnData
	 */
	public String queryProvinceData() {
		//基本数据提取策略
		//1、从缓存中取
		//2、从数据库中取存到缓存中
		List<String> provinceArray = ucfDistrictDao.queryAllProvinceData();
		List<String> cityArray = ucfDistrictDao.queryAllCityData();
		List<String> districtArray = ucfDistrictDao.queryAllDistrictData();
		JSONObject jsonObj = new JSONObject();
		jsonObj.put(PROVINCE_TAG, transformToJson(provinceArray));
		jsonObj.put(CITY_TAG, transformToJson(cityArray));
		jsonObj.put(DISTRICT_TAG, transformToJson(districtArray));
		return jsonObj.toJSONString();
	}
	/**
	 * JSON转换
	 * Description: 
	 * @Version1.0 2014-3-14 下午4:32:41 by WangYanCheng（wangyancheng@ucfgroup.com）创建
	 * @param provinceArray
	 * @return
	 */
	private static Object transformToJson(List<String> provinceArray) {
		String[] tmpArray = (String[]) provinceArray.toArray(new String[provinceArray.size()]);
		JSONArray jsonArray = new JSONArray();
		for (int i = 0; i < tmpArray.length; i++) {
			if (i%2==0) {
				JSONObject jsonObj = new JSONObject();
				jsonObj.put("code", tmpArray[i]);
				jsonObj.put("name", tmpArray[i + 1]);
				jsonArray.add(jsonObj);
			}
		}
		return jsonArray;
	}
	/**
	 * 测试用例
	 * Description: 
	 * @Version1.0 2014-3-14 下午4:46:26 by WangYanCheng（wangyancheng@ucfgroup.com）创建
	 * @param args
	 */
	public static void main(String[] args) {
		List<String> tmpArr = new ArrayList<String>();
		tmpArr.add("K1");
		tmpArr.add("V1");
		tmpArr.add("K2");
		tmpArr.add("V2");
		JSONObject jsonObj = new JSONObject();
		jsonObj.put("province", transformToJson(tmpArr));
	}
}
