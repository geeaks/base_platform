<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ucf.customer">
<!-- insert UcfBankCard -->
<insert id="insertUcfBankCard" parameterType="ucfBankCard" >
	<![CDATA[
		INSERT INTO UCF_BANK_CARD (
		ID,CARD_NO,CARD_NAME,USER_ID,BANK_ID,BANK_NAME,CARD_TYPE,
		PAYMENT_PASSWORD,REGISTER_FROM,CERT_FROM,CERT_STATUS,
		GMT_CREATE,GMT_MODIFIED,MEMO,LAST_PAY_DT,CERTIFY_INFO,
		PROVINCE,CITY,BRANCHNAME,ISSUER,CONFIRM_STATUS,PHONE,
		STATUS,UNION_SEQ,CVN2,VALID_DATE,IS_PAY,IS_WITHDRAW,IS_DELETE,USE_TYPE
		)VALUES(
		#{id,jdbcType=VARCHAR},#{cardNo,jdbcType=VARCHAR},#{cardName,jdbcType=VARCHAR},#{userId,jdbcType=VARCHAR},
		#{bankId,jdbcType=VARCHAR},#{bankName,jdbcType=VARCHAR},#{cardType,jdbcType=CHAR},
		#{paymentPassword,jdbcType=VARCHAR},#{registerFrom,jdbcType=VARCHAR},
		#{certFrom,jdbcType=VARCHAR},#{certStatus,jdbcType=CHAR},sysdate,
		sysdate,#{memo,jdbcType=VARCHAR},#{lastPayDt,jdbcType=TIMESTAMP},
		#{certifyInfo,jdbcType=VARCHAR},#{province,jdbcType=VARCHAR},#{city,jdbcType=VARCHAR},
		#{branchname,jdbcType=VARCHAR},#{issuer,jdbcType=VARCHAR},#{confirmStatus,jdbcType=VARCHAR},
		#{phone,jdbcType=VARCHAR},#{status,jdbcType=VARCHAR},#{unionSeq,jdbcType=VARCHAR},
		#{cvn2,jdbcType=VARCHAR},#{validDate,jdbcType=VARCHAR},
		#{isPay,jdbcType=VARCHAR},#{isWithdraw,jdbcType=VARCHAR},'N',#{useType,jdbcType=VARCHAR})
	]]>
</insert>

<!-- update UcfBankCard -->
<update id="updateUcfBankCard" parameterType="ucfBankCard">
	<![CDATA[
		UPDATE 
		UCF_BANK_CARD 
		SET 
		 id=id
	]]>
	<if test="null != cardName">
	<![CDATA[
,CARD_NAME = #{cardName}
	]]>
	</if>
	<if test="null != userId">
	<![CDATA[
,USER_ID = #{userId}
	]]>
	</if>
	<if test="null != cardNo">
	<![CDATA[
,CARD_NO = #{cardNo}
	]]>
	</if>
	<if test="null != bankId">
	<![CDATA[
,BANK_ID = #{bankId}
	]]>
	</if>
	<if test="null != bankName">
	<![CDATA[
,BANK_NAME = #{bankName}
	]]>
	</if>
	<if test="null != cardType">
	<![CDATA[
,CARD_TYPE = #{cardType}
	]]>
	</if>
	<if test="null != paymentPassword">
	<![CDATA[
,PAYMENT_PASSWORD = #{paymentPassword}
	]]>
	</if>
	<if test="null != registerFrom">
	<![CDATA[
,REGISTER_FROM = #{registerFrom}
	]]>
	</if>
	<if test="null != certFrom">
	<![CDATA[
,CERT_FROM = #{certFrom}
	]]>
	</if>
	<if test="null != certStatus">
		<![CDATA[
			,CERT_STATUS = #{certStatus}
		]]>
	</if>
	<if test="null != phone">
		<![CDATA[
			,PHONE = #{phone}
		]]>
	</if>
	<if test="null != memo">
	<![CDATA[
,MEMO = #{memo}
	]]>
	</if>
	<if test="null != lastPayDt">
	<![CDATA[
,LAST_PAY_DT = #{lastPayDt}
	]]>
	</if>
	<if test="null != certifyInfo">
	<![CDATA[
,CERTIFY_INFO = #{certifyInfo}
	]]>
	</if>
	<if test="null != province">
	<![CDATA[
,PROVINCE = #{province}
	]]>
	</if>
	<if test="null != city">
	<![CDATA[
,CITY = #{city}
	]]>
	</if>
	<if test="null != branchname">
	<![CDATA[
,BRANCHNAME = #{branchname}
	]]>
	</if>
	
	<if test="null != issuer">
	<![CDATA[
,ISSUER = #{issuer}
	]]>
	</if>
	<if test="null != confirmStatus">
	<![CDATA[
,CONFIRM_STATUS = #{confirmStatus}
	]]>
	</if>
		<if test="null != status">
	<![CDATA[
,STATUS = #{status}
	]]>
	</if>
	<if test="null != cvn2">
	<![CDATA[
,CVN2 = #{cvn2}
	]]>
	</if>
	<if test="null != validDate">
		<![CDATA[
,VALID_DATE = #{validDate}
		]]>
	</if>
	<if test="null != isPay">
	<![CDATA[
,IS_PAY = #{isPay}
	]]>
	</if>
	<if test="null != isWithdraw">
		<![CDATA[
,IS_WITHDRAW = #{isWithdraw}
		]]>
	</if>
	<if test="null != isDelete">
		<![CDATA[
,IS_DELETE = #{isDelete}
		]]>
	</if>
	<if test="null != unionSeq">
		<![CDATA[
,UNION_SEQ = #{unionSeq}
		]]>
	</if>
	<if test="null != useType">
		<![CDATA[
			,USE_TYPE = #{useType}
		]]>
	</if>
	<![CDATA[
	,GMT_MODIFIED=sysdate 
	]]>
<trim prefix="WHERE" prefixOverrides="AND|OR">
	<if test="null != id">
		 and ID = #{id} 
	</if>
</trim>
</update>

<!-- delete UcfBankCard -->
<delete id="deleteUcfBankCard" parameterType="string">
	<![CDATA[
		DELETE FROM UCF_BANK_CARD WHERE ID = #{id}
	]]>
</delete>

<!-- select UcfBankCard -->
<select id="queryUcfBankCardByWhere" resultType="ucfBankCard" parameterType="ucfBankCard" >
<![CDATA[
SELECT 
CARD_NO as cardNo,CARD_NAME as cardName,USER_ID as userId,BANK_ID as bankId,BANK_NAME as bankName,CARD_TYPE as cardType,PAYMENT_PASSWORD as paymentPassword,
REGISTER_FROM as registerFrom,CERT_FROM as certFrom,CERT_STATUS as certStatus,GMT_CREATE as gmtCreate,GMT_MODIFIED as gmtModified,MEMO as memo,
LAST_PAY_DT as lastPayDt,CERTIFY_INFO as certifyInfo,PROVINCE as province,CITY as city,BRANCHNAME as branchname,ID as id,ISSUER as issuer,
CONFIRM_STATUS as confirmStatus,PHONE as phone ,STATUS as status,UNION_SEQ as unionSeq,CVN2 as cvn2,VALID_DATE as validDate, 
IS_PAY as isPay,IS_WITHDRAW as isWithdraw,IS_DELETE as isDelete,USE_TYPE as useType FROM UCF_BANK_CARD 
]]>
<where>
 <![CDATA[ IS_DELETE = 'N' ]]>
<if test="null != cardNo and '' != cardNo">
<![CDATA[
AND CARD_NO = #{cardNo}
]]>
</if>
<if test="null != cardName and '' != cardName">
<![CDATA[
AND CARD_NAME = #{cardName}
]]>
</if>
<if test="null != userId and '' != userId">
<![CDATA[
AND USER_ID = #{userId}
]]>
</if>
<if test="null != bankId and '' != bankId">
<![CDATA[
AND BANK_ID = #{bankId}
]]>
</if>
<if test="null != bankName and '' != bankName">
<![CDATA[
AND BANK_NAME = #{bankName}
]]>
</if>
<if test="null != cardType and '' != cardType">
<![CDATA[
AND CARD_TYPE = #{cardType}
]]>
</if>
<if test="null != paymentPassword and '' != paymentPassword">
<![CDATA[
AND PAYMENT_PASSWORD = #{paymentPassword}
]]>
</if>
<if test="null != registerFrom and '' != registerFrom">
<![CDATA[
AND REGISTER_FROM = #{registerFrom}
]]>
</if>
<if test="null != certFrom and '' != certFrom">
<![CDATA[
AND CERT_FROM = #{certFrom}
]]>
</if>
<if test="null != certStatus and '' != certStatus">
<![CDATA[
AND CERT_STATUS = #{certStatus}
]]>
</if>
<if test="null != gmtCreate">
<![CDATA[
AND GMT_CREATE = #{gmtCreate}
]]>
</if>
<if test="null != gmtModified">
<![CDATA[
AND GMT_MODIFIED = #{gmtModified}
]]>
</if>
<if test="null != memo and '' != memo">
<![CDATA[
AND MEMO = #{memo}
]]>
</if>
<if test="null != lastPayDt">
<![CDATA[
AND LAST_PAY_DT = #{lastPayDt}
]]>
</if>
<if test="null != certifyInfo and '' != certifyInfo">
<![CDATA[
AND CERTIFY_INFO = #{certifyInfo}
]]>
</if>
<if test="null != province and '' != province">
<![CDATA[
AND PROVINCE = #{province}
]]>
</if>
<if test="null != city and '' != city">
<![CDATA[
AND CITY = #{city}
]]>
</if>
<if test="null != branchname and '' != branchname">
<![CDATA[
AND BRANCHNAME = #{branchname}
]]>
</if>
<if test="null != id">
<![CDATA[
AND ID = #{id}
]]>
</if>
<if test="null != issuer and '' != issuer">
<![CDATA[
AND ISSUER = #{issuer}
]]>
</if>
<if test="null != confirmStatus and '' != confirmStatus">
<![CDATA[
AND CONFIRM_STATUS = #{confirmStatus}
]]>
</if>
<if test="null != phone and '' != phone">
<![CDATA[
AND PHONE = #{phone}
]]>
</if>
<if test="null != status and '' != status">
<![CDATA[
AND STATUS = #{status}
]]>
</if>
<if test="null != isPay and '' != isPay">
<![CDATA[
AND IS_PAY = #{isPay}
]]>
</if>
<if test="null != isWithdraw and '' != isWithdraw">
<![CDATA[
AND IS_WITHDRAW = #{isWithdraw}
]]>
</if>
<if test="null != useType and '' != useType">
	<choose>
		<when test="'F'.toString() == useType">
			<![CDATA[
				AND (USE_TYPE = #{useType} OR USE_TYPE IS NULL)
			]]>
		</when>
		<otherwise>
			<![CDATA[
				AND USE_TYPE = #{useType}
			]]>
		</otherwise>
	</choose>
</if>
</where>
order by GMT_CREATE desc
</select>

<select id="queryUcfBankCardById" resultType="ucfBankCard" parameterType="ucfBankCard" >
<![CDATA[
SELECT CARD_NO          as cardNo,
	   CARD_NAME        as cardName,
       USER_ID          as userId,
       BANK_ID          as bankId,
       BANK_NAME        as bankName,
       CARD_TYPE        as cardType,
       PAYMENT_PASSWORD as paymentPassword,
       REGISTER_FROM    as registerFrom,
       CERT_FROM        as certFrom,
       CERT_STATUS      as certStatus,
       GMT_CREATE       as gmtCreate,
       GMT_MODIFIED     as gmtModified,
       MEMO             as memo,
       LAST_PAY_DT      as lastPayDt,
       CERTIFY_INFO     as certifyInfo,
       PROVINCE         as province,
       CITY             as city,
       BRANCHNAME       as branchname,
       ID               as id,
       ISSUER           as issuer,
       CONFIRM_STATUS   as confirmStatus,
       PHONE            as phone,
       CVN2 			as cvn2,
       VALID_DATE 		as validDate, 
	   IS_PAY 			as isPay,
	   IS_WITHDRAW 		as isWithdraw,
	   IS_DELETE 		as isDelete,
	   USE_TYPE			as useType 
  FROM UCF_BANK_CARD
 WHERE ID =#{id}
]]>
</select>

<!-- 某商户下的用户是否绑定某银行卡 -->
<select id="isBankCardBound" parameterType="java.util.Map" resultType="ucfBankCard">
	SELECT b.USER_ID as userId,b.CARD_NO as cardNo FROM UCF_BANK_CARD b ,UCF_USER u 
	where  b.USER_ID = u.USER_ID and  b.CARD_NO=#{bankCardNo} and b.IS_DELETE = 'N'	
	<if test="null != userId and '' != userId ">
	<![CDATA[
		and b.USER_ID <> #{userId}
	]]>
	</if>
	and u.REF_MERCHANT=#{merchantId}
</select>

<select id="getBankCardSeq" resultType="String" >
	SELECT UCF_BANK_CARD_SEQ.NEXTVAL AS bankCardNo FROM DUAL
</select>

<select id="getUnionSeq" resultType="String" >
	SELECT UCF_BANK_CARD_UNION_SEQ.NEXTVAL AS bankCardNo FROM DUAL
</select>

</mapper>
