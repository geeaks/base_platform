package com.ucf.customer.ws.enterprise.impl;

import java.math.BigDecimal;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.annotation.Resource;
import javax.security.auth.login.AccountException;

import org.apache.cxf.common.util.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.TransactionStatus;
import org.springframework.transaction.support.TransactionCallback;
import org.springframework.transaction.support.TransactionTemplate;

import com.alibaba.rocketmq.client.producer.SendResult;
import com.ucf.customer.api.enums.EnumBankCardType;
import com.ucf.customer.api.enums.EnumBankCardUseType;
import com.ucf.customer.api.enums.EnumCertType;
import com.ucf.customer.api.enums.EnumUserType;
import com.ucf.customer.dao.UcfBankCardDao;
import com.ucf.customer.dao.UcfOperatorDao;
import com.ucf.customer.dao.UcfOrgDao;
import com.ucf.customer.dao.UcfQuestionDao;
import com.ucf.customer.dao.UcfUserDao;
import com.ucf.customer.pojo.UcfBankCard;
import com.ucf.customer.pojo.UcfCard;
import com.ucf.customer.pojo.UcfCustomer;
import com.ucf.customer.pojo.UcfMerchantExtra;
import com.ucf.customer.pojo.UcfOrg;
import com.ucf.customer.pojo.UcfUser;
import com.ucf.customer.pojo.UcfUserLoginApp;
import com.ucf.customer.security.Cryptos;
import com.ucf.customer.service.LoginService;
import com.ucf.customer.service.UcfMerchantExtraService;
import com.ucf.customer.service.UserRegService;
import com.ucf.customer.utils.BeanUtilEx;
import com.ucf.customer.utils.Constants;
import com.ucf.customer.utils.enums.EnumAccountType;
import com.ucf.customer.utils.enums.EnumBindBankCardStatus;
import com.ucf.customer.utils.enums.EnumConfirmStatus;
import com.ucf.customer.utils.enums.EnumUserEnabledStatus;
import com.ucf.customer.utils.exception.CustomerErrorCode;
import com.ucf.customer.utils.exception.CustomerException;
import com.ucf.customer.ws.bo.BaseBO;
import com.ucf.customer.ws.bo.enterprise.Enterprisebase_platformBankCardBO;
import com.ucf.customer.ws.bo.enterprise.Enterprisebase_platformInfoResultBO;
import com.ucf.customer.ws.bo.enterprise.Enterprisebase_platformRegRequestBO;
import com.ucf.customer.ws.bo.enterprise.Enterprisebase_platformSearchReqBo;
import com.ucf.customer.ws.bo.enterprise.EnterpriseStatusReturnValueBo;
import com.ucf.customer.ws.bo.enterprise.GroupAccountBo;
import com.ucf.customer.ws.bo.enterprise.MainAccountListBO;
import com.ucf.customer.ws.bo.enterprise.base_platformRegisterResultBO;
import com.ucf.customer.ws.bo.enterprise.base_platformReviewRequestBO;
import com.ucf.customer.ws.bo.enterprise.base_platformReviewResultBO;
import com.ucf.customer.ws.bo.enterprise.OuterEnterprisebase_platformRegRequestBO;
import com.ucf.customer.ws.bo.enterprise.PageEnterprisebase_platformResultBo;
import com.ucf.customer.ws.bo.enterprise.Updatebase_platformInfoRequestBO;
import com.ucf.customer.ws.bo.enterprise.Updatebase_platformInfoResultBO;
import com.ucf.customer.ws.bo.enterprise.VerifyEmailRequestBO;
import com.ucf.customer.ws.bo.enterprise.VerifyEmailResultBO;
import com.ucf.customer.ws.enums.EnumCertFrom;
import com.ucf.customer.ws.enums.EnumCertStatus;
import com.ucf.customer.ws.enums.Enumbase_platformCode;
import com.ucf.customer.ws.enums.EnumMerchantExtra;
import com.ucf.customer.ws.enums.EnumRegisterFrom;
import com.ucf.customer.ws.service.enterprise.Enterprisebase_platformService;
import com.ucf.onlinepay.framework.common.util.DateUtil;
import com.ucf.onlinepay.framework.common.util.StringUtil;
import com.ucf.platform.framework.core.log.UcfLogger;
import com.ucf.platform.framework.core.log.UcfLoggerFactory;
import com.ucf.platform.framework.core.util.SensitiveInfoUtils;
import com.ucf.platform.framework.log.LoggerLevel;
import com.ucf.platform.framework.log.annotation.DigestLogAnnotated;
import com.ucf.platform.framework.mq.UcfSendMessage;
import com.ucf.platform.framework.mq.enums.RocketMQTopicEnum;
import com.ucf.platform.framework.mq.producer.UcfMQProducer;

public class Enterprisebase_platformServiceImpl implements Enterprisebase_platformService {

	private static final UcfLogger LOGGER = UcfLoggerFactory.getLogger(Enterprisebase_platformServiceImpl.class);
	@Autowired
	private LoginService loginService;
	@Autowired
	private UserRegService userRegService;
	@Autowired
	UcfBankCardDao ucfBankCardDao;
	@Autowired
	UcfOperatorDao ucfOperatorDao;
	@Autowired
	UcfQuestionDao ucfQuestionDao;
	@Autowired
	UcfOrgDao ucfOrgDao;
	@Autowired
	UcfUserDao ucfUserDao;
	@Resource(name = "sharedTransactionTemplate")
	private TransactionTemplate transactionTemplate;
	@Resource(name = "ucfMQProducer")
	private UcfMQProducer ucfMQProducer;
	@Autowired
	private UcfMerchantExtraService ucfMerchantExtraService;
	
	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO, isSensitiveInfo=true)
	public base_platformRegisterResultBO register(OuterEnterprisebase_platformRegRequestBO registerRequestBO) {
		LOGGER.info("企业会员注册：[" + SensitiveInfoUtils.getJson(registerRequestBO) + "] ");
		base_platformRegisterResultBO base_platformRegisterResultBO = new base_platformRegisterResultBO();
		try {
			if (registerRequestBO.getMerchantId() == null || "".equals(registerRequestBO.getMerchantId()) || registerRequestBO.getEndDate() == null || "".equals(registerRequestBO.getEndDate()) || registerRequestBO.getOuterUserId() == null || "".equals(registerRequestBO.getOuterUserId())
					|| registerRequestBO.getAgentPersonNo() == null || "".equals(registerRequestBO.getAgentPersonNo()) || registerRequestBO.getBusinessLicense() == null || "".equals(registerRequestBO.getBusinessLicense()) || registerRequestBO.getLegalPersonNo() == null
					|| "".equals(registerRequestBO.getLegalPersonNo())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.PARAM_ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.PARAM_ERROR.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.PARAM_ERROR.getCode());
				return base_platformRegisterResultBO;
			}
			Pattern endDatePattern = Pattern.compile("^[0-9]{4}(((0[13578]|(10|12))(0[1-9]|[1-2][0-9]|3[0-1]))|(02(0[1-9]|[1-2][0-9]))|((0[469]|11)(0[1-9]|[1-2][0-9]|30)))$");
			Matcher endDateMatcher = endDatePattern.matcher(registerRequestBO.getEndDate());
			if (!endDateMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.DATE_PARSE_ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.DATE_PARSE_ERROR.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.DATE_PARSE_ERROR.getCode());
				return base_platformRegisterResultBO;
			}

			if (registerRequestBO.getAgentPersonPhone() == null || "".equals(registerRequestBO.getAgentPersonPhone())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}
			Pattern agentPersonPhonePattern = Pattern.compile("^1[3|4|5|8][0-9]\\d{8}$");
			Matcher agentPersonPhoneMatcher = agentPersonPhonePattern.matcher(registerRequestBO.getAgentPersonPhone());
			if (!agentPersonPhoneMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}

			if (registerRequestBO.getAgentPersonNo() == null || "".equals(registerRequestBO.getAgentPersonNo())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}

			Pattern agentPersonNoPattern = Pattern.compile("(^\\d{15}$)|(^\\d{17}([0-9]|X)$)");
			Matcher agentPersonNoMatcher = agentPersonNoPattern.matcher(registerRequestBO.getAgentPersonNo());
			if (!agentPersonNoMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONNO_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}
			Matcher legalPersonNoMatcher = agentPersonNoPattern.matcher(registerRequestBO.getLegalPersonNo());
			if (!legalPersonNoMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}
			if (registerRequestBO.getEnterpriseFullName() == null || !registerRequestBO.getEnterpriseFullName().equals(registerRequestBO.getBankCardName())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.ENTERPRISEFULLNAME_NOT_EQUEL_BANKCARDNAME.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.ENTERPRISEFULLNAME_NOT_EQUEL_BANKCARDNAME.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.ENTERPRISEFULLNAME_NOT_EQUEL_BANKCARDNAME.getCode());
				return base_platformRegisterResultBO;
			}

			UcfUser user = new UcfUser();
			user.setCell(registerRequestBO.getAgentPersonPhone());
			user.setRefMerchant(registerRequestBO.getMerchantId());
			List<UcfUser> userList = this.loginService.queryUcfUser(user);
			if (!userList.isEmpty()) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.CELL_EXIST.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.CELL_EXIST.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.CELL_EXIST.getMsgS());
				return base_platformRegisterResultBO;
			}

			// 生成用户ID
			String userId = userRegService.queryUcfUserId();

			// 此时生成用户信息
			final UcfUser ucfUser = new UcfUser();
			ucfUser.setUserId(userId);
			ucfUser.setRefUser(registerRequestBO.getOuterUserId());
			ucfUser.setRefMerchant(registerRequestBO.getMerchantId());
			ucfUser.setEnabledStatus(EnumUserEnabledStatus.W.getCode());// W：注册未激活
			ucfUser.setCell(registerRequestBO.getAgentPersonPhone());
			ucfUser.setPhone(registerRequestBO.getAgentPersonPhone());
			ucfUser.setCertNo(registerRequestBO.getBusinessLicense());
			ucfUser.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			ucfUser.setRealName(registerRequestBO.getAgentPersonName());
			ucfUser.setFirmName(registerRequestBO.getEnterpriseShortName());// 企业简称
			ucfUser.setGmtCreate(new Date());
			ucfUser.setGmtLastModified(new Date());
			ucfUser.setUserType(BigDecimal.valueOf(Integer.valueOf(EnumUserType.ENTERPRISE.getCode())));

			// 生成卡信息
			final UcfCard ucfCard = new UcfCard();
			ucfCard.setCardNo(userId);
			ucfCard.setUserId(userId);
			ucfCard.setCardType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			ucfCard.setGmtCreate(new Date());
			ucfCard.setCertFrom(EnumCertFrom.WEB_FROM.getCode());
			ucfCard.setCertStatus(EnumCertStatus.NO_CERT.getCode());
			ucfCard.setRegisterFrom(EnumRegisterFrom.P2P_FROM.getCode());

			// 生成客户信息
			final UcfCustomer customer = new UcfCustomer();
			customer.setCertNo(registerRequestBO.getBusinessLicense());// 企业执照号
			customer.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			customer.setName(registerRequestBO.getEnterpriseFullName());// 企业全称
			customer.setNational("CHA");
			customer.setType(Constants.CUSTOMER_TYPE_ORG);
			customer.setGmtCreate(new Date());
			customer.setExtFlag(Constants.EXT_FLAG_T);
			customer.setOpenStatus(Constants.OPEN_STATUS_YES);
			customer.setEnableStatus(Constants.ENABLE_STATUS_T);
			customer.setCertStatus(Constants.VERIFY_STATUS_T);

			final UcfBankCard ucfBankCard = new UcfBankCard();
			StringBuffer id = new StringBuffer();
			SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
			StringBuffer seq = id.append(sdf.format(new Date())).append(this.ucfBankCardDao.getBankCardSeq());
			ucfBankCard.setId(seq.toString());
			ucfBankCard.setUserId(userId);
			ucfBankCard.setBankName(registerRequestBO.getBankName());
			ucfBankCard.setBankId(registerRequestBO.getBankCode());
			ucfBankCard.setCardNo(registerRequestBO.getBankCardNo());
			ucfBankCard.setCardName(registerRequestBO.getEnterpriseFullName());
			ucfBankCard.setCardType(EnumBankCardType.BUSINESS_ACCOUNT.getCode());
			ucfBankCard.setCertFrom("system");
			ucfBankCard.setRegisterFrom("system");
			ucfBankCard.setGmtCreate(new Date());
			ucfBankCard.setCertifyInfo("system");// branchName
			ucfBankCard.setBranchname(registerRequestBO.getIssuerName());
			ucfBankCard.setIssuer(registerRequestBO.getIssuer());
			ucfBankCard.setCity(registerRequestBO.getCity());
			ucfBankCard.setProvince(registerRequestBO.getProvinces());
			ucfBankCard.setUnionSeq(ucfBankCardDao.getUnionSeq());
			ucfBankCard.setStatus(EnumBindBankCardStatus.SUCCESS.getCode());
			// P2P 外部 企业用户为理财卡
			ucfBankCard.setUseType(EnumBankCardUseType.FINANCIAL.getCode());
			// ucfBankCard.setConfirmStatus(EnumConfirmStatus.CONFIRM_YES.getCode());

			String ucfOrgId = userRegService.queryUcfUserId();
			final UcfOrg ucfOrg = new UcfOrg();
			ucfOrg.setId(ucfOrgId);
			// ucfOrg.setCustomerId("");
			ucfOrg.setRealName(registerRequestBO.getEnterpriseFullName());
			ucfOrg.setCoperation(registerRequestBO.getLegalPersonName());
			ucfOrg.setAgentCard(registerRequestBO.getAgentPersonNo());// 代理人证件号码
			ucfOrg.setAgentName(registerRequestBO.getAgentPersonName());// 代理人姓名
			ucfOrg.setCoperationCard(registerRequestBO.getLegalPersonNo());
			ucfOrg.setCountry("CHA");// 国家
			ucfOrg.setProvince(registerRequestBO.getProvinces());
			ucfOrg.setCity(registerRequestBO.getCity());
			ucfOrg.setAddress(registerRequestBO.getEnterpriseAddress());
			ucfOrg.setCell(registerRequestBO.getEnterprisePhone());
			ucfOrg.setGmtCreate(new Date());
			ucfOrg.setGmtModified(new Date());
			ucfOrg.setUserId(userId);
			ucfOrg.setCompanyFullName(registerRequestBO.getEnterpriseFullName());
			ucfOrg.setCompanyName(registerRequestBO.getEnterpriseShortName());
			ucfOrg.setCharetNo(registerRequestBO.getBusinessLicense());
			ucfOrg.setCharetExpire(DateUtil.formatStringToDate(registerRequestBO.getEndDate(), "yyyyMMdd"));
			ucfOrg.setLegalPerson(registerRequestBO.getLegalPersonName());
			ucfOrg.setLegalIdentity(registerRequestBO.getLegalPersonNo());
			ucfOrg.setCompanyAdd(registerRequestBO.getEnterpriseAddress());
			ucfOrg.setSettleBankCode(registerRequestBO.getBankCode());
			ucfOrg.setSettleBankName(registerRequestBO.getBankName());
			ucfOrg.setSettleCardNo(registerRequestBO.getBankCardNo());
			ucfOrg.setBranchName(registerRequestBO.getIssuerName());
			ucfOrg.setPayeeName(registerRequestBO.getBankCardName());

			String result = loginService.createAcccount(null, EnumAccountType.MERCHANT, ucfCard);
			if (!result.equals("success")) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getMsgS());
				return base_platformRegisterResultBO;
			}

			boolean commit = (Boolean) transactionTemplate.execute(new TransactionCallback<Object>() {
				public Object doInTransaction(final TransactionStatus status) {
					try {
						UcfUser ucfUserInfo = loginService.queryUserInfo(ucfUser.getUserId());

						if (ucfUserInfo != null) {
							throw new CustomerException(CustomerErrorCode.ERROR_USERINFO_ERR);
						}
						// 保存用户信息
						userRegService.insertUserInfo(ucfUser);
						UcfCustomer validateCustomer = new UcfCustomer();
						validateCustomer.setCertNo(customer.getCertNo());
						UcfCustomer validateCustomerRep = loginService.queryUcfCustomerInfo(validateCustomer);
						if (validateCustomerRep == null) {
							loginService.insertCustomer(customer);
							UcfCustomer customer1 = new UcfCustomer();
							customer1.setCertNo(customer.getCertNo());// 企业执照号
							customer1.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
							ucfOrg.setCustomerId(loginService.queryUcfCustomerInfo(customer1).getCustomerId());
						} else {
							ucfOrg.setCustomerId(validateCustomerRep.getCustomerId());
						}
						ucfCard.setCustomerId(ucfOrg.getCustomerId());
						// 保存卡信息
						loginService.insertCardInfo(ucfCard);
						loginService.insertBankCardInfo(ucfBankCard);
						loginService.insertOrganizational(ucfOrg);
					} catch (final Exception e) {
						LOGGER.error(e.getMessage(), e);
						status.setRollbackOnly();
						return false;

					}
					return true;
				}
			});
			if (commit) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
				base_platformRegisterResultBO.setUserId(userId);
				return base_platformRegisterResultBO;
			} else {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
				return base_platformRegisterResultBO;
			}
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			base_platformRegisterResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return base_platformRegisterResultBO;
		}

	}

	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO, isSensitiveInfo=true)
	public Updatebase_platformInfoResultBO updatebase_platformInfo(Updatebase_platformInfoRequestBO updatebase_platformInfoRequestBO) {
		Updatebase_platformInfoResultBO updatebase_platformInfoResultBO = new Updatebase_platformInfoResultBO();
		if (updatebase_platformInfoRequestBO.getMerchantId() == null || "".equals(updatebase_platformInfoRequestBO.getMerchantId())) {
			updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getMsgS());
			updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			return updatebase_platformInfoResultBO;
		}
		if (updatebase_platformInfoRequestBO.getUserId() == null || "".equals(updatebase_platformInfoRequestBO.getUserId())) {
			updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			return updatebase_platformInfoResultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(updatebase_platformInfoRequestBO.getUserId());
		user.setRefMerchant(updatebase_platformInfoRequestBO.getMerchantId());
		try {
			UcfUser queryUser = new UcfUser();
			queryUser.setCell(updatebase_platformInfoRequestBO.getAgentPersonPhone());
			queryUser.setRefMerchant(updatebase_platformInfoRequestBO.getMerchantId());
			List<UcfUser> userList = this.loginService.queryUcfUser(queryUser);
			if (!userList.isEmpty()) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.CELL_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.CELL_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.CELL_EXIST.getMsgS());
				return updatebase_platformInfoResultBO;
			}
			final UcfUser userinfo = this.loginService.queryUcfUserInfo(user);
			if (userinfo == null) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return updatebase_platformInfoResultBO;
			}
			if (updatebase_platformInfoRequestBO.getAgentPersonPhone() != null && !"".equals(updatebase_platformInfoRequestBO.getAgentPersonPhone().trim())) {
				userinfo.setCell(updatebase_platformInfoRequestBO.getAgentPersonPhone());
			}
			if (updatebase_platformInfoRequestBO.getAgentPersonNo() != null && !"".equals(updatebase_platformInfoRequestBO.getAgentPersonNo().trim())) {
				userinfo.setCertNo(updatebase_platformInfoRequestBO.getAgentPersonNo().trim());
			}
			if (updatebase_platformInfoRequestBO.getAgentPersonName() != null && !"".equals(updatebase_platformInfoRequestBO.getAgentPersonName().trim())) {
				userinfo.setRealName(updatebase_platformInfoRequestBO.getAgentPersonName().trim());
			}
			if (updatebase_platformInfoRequestBO.getEnterpriseShortName() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterpriseShortName().trim())) {
				userinfo.setFirmName(updatebase_platformInfoRequestBO.getEnterpriseShortName().trim());// 企业简称
			}
			userinfo.setGmtLastModified(new Date());
			final UcfOrg ucfOrg = ucfOrgDao.quertUcfByUserId(userinfo.getUserId());
			if (ucfOrg == null) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return updatebase_platformInfoResultBO;
			}
			if (updatebase_platformInfoRequestBO.getLegalPersonName() != null && !"".equals(updatebase_platformInfoRequestBO.getLegalPersonName().trim())) {
				ucfOrg.setCoperation(updatebase_platformInfoRequestBO.getLegalPersonName());
			}
			if (updatebase_platformInfoRequestBO.getAgentPersonNo() != null && !"".equals(updatebase_platformInfoRequestBO.getAgentPersonNo().trim())) {
				ucfOrg.setAgentCard(updatebase_platformInfoRequestBO.getAgentPersonNo());// 代理人证件号码
			}
			if (updatebase_platformInfoRequestBO.getAgentPersonName() != null && !"".equals(updatebase_platformInfoRequestBO.getAgentPersonName().trim())) {
				ucfOrg.setAgentName(updatebase_platformInfoRequestBO.getAgentPersonName());// 代理人姓名
			}
			if (updatebase_platformInfoRequestBO.getLegalPersonNo() != null && !"".equals(updatebase_platformInfoRequestBO.getLegalPersonNo().trim())) {
				ucfOrg.setCoperationCard(updatebase_platformInfoRequestBO.getLegalPersonNo());
			}
			if (updatebase_platformInfoRequestBO.getEnterpriseAddress() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterpriseAddress().trim())) {
				ucfOrg.setAddress(updatebase_platformInfoRequestBO.getEnterpriseAddress());
			}
			if (updatebase_platformInfoRequestBO.getEnterprisePhone() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterprisePhone().trim())) {
				ucfOrg.setCell(updatebase_platformInfoRequestBO.getEnterprisePhone());
			}
			if (updatebase_platformInfoRequestBO.getEnterpriseFullName() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterpriseFullName().trim())) {
				ucfOrg.setCompanyFullName(updatebase_platformInfoRequestBO.getEnterpriseFullName());
			}
			if (updatebase_platformInfoRequestBO.getEnterpriseShortName() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterpriseShortName().trim())) {
				ucfOrg.setCompanyName(updatebase_platformInfoRequestBO.getEnterpriseShortName());
			}
			if (updatebase_platformInfoRequestBO.getBusinessLicense() != null && !"".equals(updatebase_platformInfoRequestBO.getBusinessLicense().trim())) {
				ucfOrg.setCharetNo(updatebase_platformInfoRequestBO.getBusinessLicense());
			}
			if (updatebase_platformInfoRequestBO.getEndDate() != null && !"".equals(updatebase_platformInfoRequestBO.getEndDate().trim())) {
				ucfOrg.setCharetExpire(DateUtil.formatStringToDate(updatebase_platformInfoRequestBO.getEndDate().trim(), "yyyyMMdd"));
			}
			if (updatebase_platformInfoRequestBO.getLegalPersonName() != null && !"".equals(updatebase_platformInfoRequestBO.getLegalPersonName().trim())) {
				ucfOrg.setLegalPerson(updatebase_platformInfoRequestBO.getLegalPersonName());
			}
			if (updatebase_platformInfoRequestBO.getLegalPersonNo() != null && !"".equals(updatebase_platformInfoRequestBO.getLegalPersonNo().trim())) {
				ucfOrg.setLegalIdentity(updatebase_platformInfoRequestBO.getLegalPersonNo());
			}
			if (updatebase_platformInfoRequestBO.getEnterpriseAddress() != null && !"".equals(updatebase_platformInfoRequestBO.getEnterpriseAddress().trim())) {
				ucfOrg.setCompanyAdd(updatebase_platformInfoRequestBO.getEnterpriseAddress());
			}
			ucfOrg.setGmtModified(new Date());
			boolean commit = (Boolean) transactionTemplate.execute(new TransactionCallback<Object>() {
				public Object doInTransaction(final TransactionStatus status) {
					try {
						loginService.updateUcfUser(userinfo);
						ucfOrgDao.updateUcfOrg(ucfOrg);
					} catch (final Exception e) {
						LOGGER.error(e.getMessage(), e);
						status.setRollbackOnly();
						return false;
					}
					return true;
				}
			});
			if (commit) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
				updatebase_platformInfoResultBO.setUserId(userinfo.getUserId());
				return updatebase_platformInfoResultBO;
			} else {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
				return updatebase_platformInfoResultBO;
			}
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return updatebase_platformInfoResultBO;
		}
	}

	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO, isSensitiveInfo=true)
	public base_platformRegisterResultBO merchantRegister(Enterprisebase_platformRegRequestBO registerRequestBO) {
		LOGGER.info("商户注册：[" + SensitiveInfoUtils.getJson(registerRequestBO) + "] ");
		base_platformRegisterResultBO base_platformRegisterResultBO = new base_platformRegisterResultBO();
		try {
			if (StringUtil.isEmpty(registerRequestBO.getEndDate()) 
					|| StringUtil.isEmpty(registerRequestBO.getBusinessLicense()) 
					|| StringUtil.isEmpty(registerRequestBO.getLegalPersonNo()) 
					|| StringUtil.isEmpty(registerRequestBO.getEmail()) 
					|| registerRequestBO.getLoginPassword() == null
					|| registerRequestBO.getLoginPassword().length == 0 
					|| StringUtil.isEmpty(registerRequestBO.getMerchantType())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.PARAM_ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.PARAM_ERROR.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.PARAM_ERROR.getCode());
				return base_platformRegisterResultBO;
			}
			Pattern endDatePattern = Pattern.compile("^[0-9]{4}(((0[13578]|(10|12))(0[1-9]|[1-2][0-9]|3[0-1]))|(02(0[1-9]|[1-2][0-9]))|((0[469]|11)(0[1-9]|[1-2][0-9]|30)))$");
			Matcher endDateMatcher = endDatePattern.matcher(registerRequestBO.getEndDate());
			if (!endDateMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.DATE_PARSE_ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.DATE_PARSE_ERROR.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.DATE_PARSE_ERROR.getCode());
				return base_platformRegisterResultBO;
			}
			if (StringUtils.isEmpty(registerRequestBO.getBankCardNo())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.BANKCARDNO_NOT_NULL.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.BANKCARDNO_NOT_NULL.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.BANKCARDNO_NOT_NULL.getCode());
				return base_platformRegisterResultBO;
			}
			if (registerRequestBO.getAgentPersonPhone() == null || "".equals(registerRequestBO.getAgentPersonPhone())) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}
			Pattern agentPersonPhonePattern = Pattern.compile("^1\\d{10}$");
			Matcher agentPersonPhoneMatcher = agentPersonPhonePattern.matcher(registerRequestBO.getAgentPersonPhone());
			if (!agentPersonPhoneMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.AGENTPERSONPHONE_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}

			if (registerRequestBO.getLegalPersonNo().length() > 30) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.LEGALPERSONNO_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}
			Pattern emailPattern = Pattern.compile("\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*");
			Matcher emailMatcher = emailPattern.matcher(registerRequestBO.getEmail());
			if (!emailMatcher.matches()) {
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.EMAIL_IS_FAIL_RULES.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.EMAIL_IS_FAIL_RULES.getMsgS());
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.EMAIL_IS_FAIL_RULES.getCode());
				return base_platformRegisterResultBO;
			}

			UcfUser user = new UcfUser();
			user.setCell(registerRequestBO.getAgentPersonPhone());
			user.setUserType(BigDecimal.valueOf(Integer.valueOf(EnumUserType.ENTERPRISE.getCode())));
			List<UcfUser> userList = this.loginService.queryUcfUser(user);
			if (!userList.isEmpty()) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.CELL_EXIST.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.CELL_EXIST.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.CELL_EXIST.getMsgS());
				return base_platformRegisterResultBO;
			}

			// 生成用户ID
			String userId = userRegService.getEnterprisebase_platformNO();

			// 此时生成用户信息
			final UcfUser ucfUser = new UcfUser();
			ucfUser.setUserId(userId);
			ucfUser.setEnabledStatus(EnumUserEnabledStatus.W.getCode());// W：注册未激活
			ucfUser.setPhone(registerRequestBO.getAgentPersonPhone());//// 手机号处理
			ucfUser.setCertNo(registerRequestBO.getBusinessLicense());
			ucfUser.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			ucfUser.setRealName(registerRequestBO.getEnterpriseFullName());
			ucfUser.setFirmName(registerRequestBO.getEnterpriseShortName());// 企业简称
			ucfUser.setEmail(registerRequestBO.getEmail());
			ucfUser.setZipCode(registerRequestBO.getZipCode());
			ucfUser.setReturnUrl(registerRequestBO.getEnterpriseURL());
			ucfUser.setAddress(registerRequestBO.getEnterpriseAddress());
			ucfUser.setCertValidEndDate(DateUtil.formatStringToDate(registerRequestBO.getEndDate(), "yyyyMMdd"));
			ucfUser.setGmtCreate(new Date());
			ucfUser.setGmtLastModified(new Date());
			ucfUser.setUserType(BigDecimal.valueOf(Integer.valueOf(EnumUserType.ENTERPRISE.getCode())));
			ucfUser.setLoginId(registerRequestBO.getAgentPersonPhone());
			ucfUser.setLgnPwd(Cryptos.encrypt(new String(registerRequestBO.getLoginPassword()), userId));
			ucfUser.setIsSignCustomer("Y");
			ucfUser.setCell(registerRequestBO.getAgentPersonPhone());
			
			//生成商户登录信息
			final UcfUserLoginApp userLoginApp = new UcfUserLoginApp();
			userLoginApp.setLoginId(registerRequestBO.getEmail());
			userLoginApp.setUserId(userId);
			userLoginApp.setEmail(registerRequestBO.getEmail());
			userLoginApp.setFrozenState(Constants.FROZEN_NO);
			userLoginApp.setLoginPwd(Cryptos.encrypt(new String(registerRequestBO.getLoginPassword()), userId));
			userLoginApp.setUserType(EnumUserType.ENTERPRISE.getCode());
			userLoginApp.setLoginType(Constants.LOGIN_TYPE_EMAIL);
			
			// 生成卡信息
			final UcfCard ucfCard = new UcfCard();
			ucfCard.setCardNo(userId);
			ucfCard.setUserId(userId);
			ucfCard.setCardType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			ucfCard.setGmtCreate(new Date());
			ucfCard.setCertFrom(EnumCertFrom.WEB_FROM.getCode());
			ucfCard.setCertStatus(EnumCertStatus.NO_CERT.getCode());
			ucfCard.setRegisterFrom(EnumRegisterFrom.P2P_FROM.getCode());
			// add by gaoxiang 如果入参有支付密码 则设置支付密码 否则默认六个8
			if (registerRequestBO.getPayPassword() != null && registerRequestBO.getPayPassword().length > 0) {
				ucfCard.setPaymentPassword(Cryptos.encrypt(new String(registerRequestBO.getPayPassword()), userId));
			} else {
				ucfCard.setPaymentPassword("888888");
			}
			
			//生成商户补充属性信息
			final UcfMerchantExtra ucfMerchantExtra = new UcfMerchantExtra();
			ucfMerchantExtra.setUserId(userId);
			ucfMerchantExtra.setMerchantType(registerRequestBO.getMerchantType());
			ucfMerchantExtra.setAccountType(registerRequestBO.getAccountType());
			ucfMerchantExtra.setParentUserId(registerRequestBO.getParentUserId());
			ucfMerchantExtra.setFirstBusinessCode(registerRequestBO.getFirstBusinessCode());
			ucfMerchantExtra.setFirstBusinessName(registerRequestBO.getFirstBusinessName());
			ucfMerchantExtra.setSecondBusinessCode(registerRequestBO.getSecondBusinessCode());
			ucfMerchantExtra.setSecondBusinessName(registerRequestBO.getSecondBusinessName());
			ucfMerchantExtra.setProductCode(registerRequestBO.getProductCode());
			ucfMerchantExtra.setProductName(registerRequestBO.getProductName());
			
			// 生成客户信息
			final UcfCustomer customer = new UcfCustomer();
			customer.setCertNo(registerRequestBO.getBusinessLicense());// 企业执照号
			customer.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
			customer.setName(registerRequestBO.getEnterpriseFullName());// 企业全称
			customer.setNational("CHA");
			customer.setType(Constants.CUSTOMER_TYPE_ORG);
			customer.setGmtCreate(new Date());
			customer.setExtFlag(Constants.EXT_FLAG_F);
			customer.setOpenStatus(Constants.OPEN_STATUS_YES);
			customer.setEnableStatus(Constants.ENABLE_STATUS_T);
			customer.setCertStatus(Constants.VERIFY_STATUS_T);

			final UcfBankCard ucfBankCard = new UcfBankCard();
			StringBuffer id = new StringBuffer();
			SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
			StringBuffer seq = id.append(sdf.format(new Date())).append(this.ucfBankCardDao.getBankCardSeq());
			ucfBankCard.setId(seq.toString());
			ucfBankCard.setUserId(userId);
			ucfBankCard.setBankName(registerRequestBO.getBankName());
			ucfBankCard.setBankId(registerRequestBO.getBankCode());
			ucfBankCard.setCardNo(registerRequestBO.getBankCardNo());
			ucfBankCard.setCardName(registerRequestBO.getBankCardName());
			ucfBankCard.setCardType(EnumBankCardType.BUSINESS_ACCOUNT.getCode());
			ucfBankCard.setCertFrom("system");
			ucfBankCard.setRegisterFrom("system");
			ucfBankCard.setGmtCreate(new Date());
			ucfBankCard.setCertifyInfo("system");// branchName
			ucfBankCard.setBranchname(registerRequestBO.getIssuerName());
			ucfBankCard.setCity(registerRequestBO.getCity());
			ucfBankCard.setProvince(registerRequestBO.getProvinces());
			ucfBankCard.setUnionSeq(ucfBankCardDao.getUnionSeq());
			ucfBankCard.setStatus(EnumBindBankCardStatus.SUCCESS.getCode());
			ucfBankCard.setIssuer(registerRequestBO.getIssuer());

			// 商户开户 银行卡使用类型为 结算卡
			ucfBankCard.setUseType(EnumBankCardUseType.SETTLE.getCode());
			// ucfBankCard.setConfirmStatus(EnumConfirmStatus.CONFIRM_YES.getCode());

			String ucfOrgId = userRegService.queryUcfUserId();
			final UcfOrg ucfOrg = new UcfOrg();
			ucfOrg.setId(ucfOrgId);
			ucfOrg.setUserId(userId);
			ucfOrg.setRealName(registerRequestBO.getEnterpriseFullName());
			ucfOrg.setCoperation(registerRequestBO.getLegalPersonName());
			ucfOrg.setAgentName(registerRequestBO.getAgentPersonName());// 代理人姓名
			ucfOrg.setAgentCard(registerRequestBO.getAgentPersonNo()); //代理人号码
			ucfOrg.setCoperationCard(registerRequestBO.getLegalPersonNo());
			ucfOrg.setCountry("CHA");// 国家
			ucfOrg.setProvince(registerRequestBO.getProvinces());
			ucfOrg.setCity(registerRequestBO.getCity());
			ucfOrg.setAddress(registerRequestBO.getEnterpriseAddress());
			ucfOrg.setCell(registerRequestBO.getEnterprisePhone());
			ucfOrg.setFax(registerRequestBO.getFax());
			ucfOrg.setZip(registerRequestBO.getZipCode());
			ucfOrg.setEmail(registerRequestBO.getEmail());
			ucfOrg.setGmtCreate(new Date());
			ucfOrg.setGmtModified(new Date());
			ucfOrg.setCompanyFullName(registerRequestBO.getEnterpriseFullName());
			ucfOrg.setCompanyName(registerRequestBO.getEnterpriseShortName());
			ucfOrg.setCharetNo(registerRequestBO.getBusinessLicense());
			ucfOrg.setCharetExpire(DateUtil.formatStringToDate(registerRequestBO.getEndDate(), "yyyyMMdd"));
			ucfOrg.setLegalPerson(registerRequestBO.getLegalPersonName());

			ucfOrg.setLegalIdentityType(registerRequestBO.getLegalIdentityType());
			ucfOrg.setLegalIdentity(registerRequestBO.getLegalPersonNo());
			ucfOrg.setCompanyAdd(registerRequestBO.getEnterpriseAddress());
			ucfOrg.setMallUrl(registerRequestBO.getEnterpriseURL());
			ucfOrg.setPost(registerRequestBO.getZipCode());
			ucfOrg.setLicenseCopy(registerRequestBO.getLegalIdentityCopy());
			ucfOrg.setOrgCertificate(registerRequestBO.getOrgCertificate());
			ucfOrg.setTaxCertificate(registerRequestBO.getTaxCertificate());
			ucfOrg.setLegalIdentityCop(registerRequestBO.getLegalIdentityCopy());
			String result = loginService.createAcccount(null, EnumAccountType.MERCHANT, ucfCard);
			if (!result.equals("success")) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.OPEN_ACCOUNT_FAIL.getMsgS());
				return base_platformRegisterResultBO;
			}
			boolean commit = (Boolean) transactionTemplate.execute(new TransactionCallback<Object>() {
				public Object doInTransaction(final TransactionStatus status) {
					try {
						UcfUser ucfUserInfo = loginService.queryUserInfo(ucfUser.getUserId());
						if (ucfUserInfo != null) {
							throw new CustomerException(CustomerErrorCode.ERROR_USERINFO_ERR);
						}
						// 保存用户信息
						userRegService.insertUserInfo(ucfUser);
						UcfCustomer validateCustomer = new UcfCustomer();
						validateCustomer.setCertNo(customer.getCertNo());
						UcfCustomer validateCustomerRep = loginService.queryUcfCustomerInfo(validateCustomer);
						if (validateCustomerRep == null) {
							loginService.insertCustomer(customer);
							UcfCustomer customer1 = new UcfCustomer();
							customer1.setCertNo(customer.getCertNo());// 企业执照号
							customer1.setCertType(EnumCertType.BUSINESS_LICENSE_CRET.getCode());
							ucfOrg.setCustomerId(loginService.queryUcfCustomerInfo(customer1).getCustomerId());
						} else {
							ucfOrg.setCustomerId(validateCustomerRep.getCustomerId());
						}
						ucfCard.setCustomerId(ucfOrg.getCustomerId());
						loginService.insertCardInfo(ucfCard);
						loginService.insertLoginAppInfo(userLoginApp);
						loginService.insertBankCardInfo(ucfBankCard);
						loginService.insertOrganizational(ucfOrg);
						ucfMerchantExtraService.insertUcfMerchantExtra(ucfMerchantExtra);
					} catch (final Exception e) {
						LOGGER.error(e.getMessage(), e);
						status.setRollbackOnly();
						return false;
					}
					return true;
				}
			});
			if (commit) {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
				base_platformRegisterResultBO.setUserId(userId);
				return base_platformRegisterResultBO;
			} else {
				base_platformRegisterResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
				base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
				base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
				return base_platformRegisterResultBO;
			}
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			base_platformRegisterResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			base_platformRegisterResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			base_platformRegisterResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return base_platformRegisterResultBO;
		}

	}

	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO, isSensitiveInfo=true)
	public Updatebase_platformInfoResultBO updateMerchantbase_platformInfo(final Updatebase_platformInfoRequestBO updatebase_platformInfoRequestBO) {
		Updatebase_platformInfoResultBO updatebase_platformInfoResultBO = new Updatebase_platformInfoResultBO();
		if (updatebase_platformInfoRequestBO.getUserId() == null || "".equals(updatebase_platformInfoRequestBO.getUserId())) {
			updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			return updatebase_platformInfoResultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(updatebase_platformInfoRequestBO.getUserId());
		try {
			final UcfUser userinfo = this.loginService.queryUcfUserInfo(user);
			if (userinfo == null) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return updatebase_platformInfoResultBO;
			}
			final UcfOrg ucfOrg = ucfOrgDao.quertUcfByUserId(userinfo.getUserId());
			if (ucfOrg == null) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return updatebase_platformInfoResultBO;
			}
			UcfCustomer queryCustomer = new UcfCustomer();
			queryCustomer.setCustomerId(ucfOrg.getCustomerId());
			final UcfCustomer customer = loginService.queryUcfCustomerInfo(queryCustomer);
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnterpriseFullName())) {
				userinfo.setRealName(updatebase_platformInfoRequestBO.getEnterpriseFullName());// 企业全称
				ucfOrg.setRealName(updatebase_platformInfoRequestBO.getEnterpriseFullName());
				ucfOrg.setCompanyFullName(updatebase_platformInfoRequestBO.getEnterpriseFullName());
				customer.setName(updatebase_platformInfoRequestBO.getEnterpriseFullName());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBusinessLicense())) {
				userinfo.setCertNo(updatebase_platformInfoRequestBO.getBusinessLicense());// 营业执照
				customer.setCertNo(updatebase_platformInfoRequestBO.getBusinessLicense());
				ucfOrg.setCharetNo(updatebase_platformInfoRequestBO.getBusinessLicense());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnterpriseShortName())) {
				userinfo.setFirmName(updatebase_platformInfoRequestBO.getEnterpriseShortName().trim());// 企业简称
				ucfOrg.setCompanyName(updatebase_platformInfoRequestBO.getEnterpriseShortName());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getAgentPersonPhone())) {
				userinfo.setPhone(updatebase_platformInfoRequestBO.getAgentPersonPhone());
				userinfo.setLoginId(updatebase_platformInfoRequestBO.getAgentPersonPhone());
				userinfo.setCell(updatebase_platformInfoRequestBO.getAgentPersonPhone());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnabledStatus())) {
				userinfo.setEnabledStatus(updatebase_platformInfoRequestBO.getEnabledStatus().trim());// 开户状态
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getZipCode())) {
				userinfo.setZipCode(updatebase_platformInfoRequestBO.getZipCode().trim());
				ucfOrg.setZip(updatebase_platformInfoRequestBO.getZipCode());
				ucfOrg.setPost(updatebase_platformInfoRequestBO.getZipCode());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnterpriseURL())) {
				userinfo.setReturnUrl(updatebase_platformInfoRequestBO.getEnterpriseURL().trim());
				ucfOrg.setMallUrl(updatebase_platformInfoRequestBO.getEnterpriseURL().trim());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnterpriseAddress())) {
				userinfo.setAddress(updatebase_platformInfoRequestBO.getEnterpriseAddress().trim());// 企业地址
				ucfOrg.setAddress(updatebase_platformInfoRequestBO.getEnterpriseAddress());
				ucfOrg.setCompanyAdd(updatebase_platformInfoRequestBO.getEnterpriseAddress());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEndDate())) {
				userinfo.setCertValidEndDate(DateUtil.formatStringToDate(updatebase_platformInfoRequestBO.getEndDate(), "yyyyMMdd"));// 证件有效期
			}
			// 增加 修改商户登录信息表 登录密码
			final UcfUserLoginApp loginApp = this.loginService.queryUserAppInfo(userinfo.getEmail());
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLoginPassword())) {
				String loginPassword = Cryptos.encrypt(updatebase_platformInfoRequestBO.getLoginPassword().trim(), user.getUserId());
				userinfo.setLgnPwd(loginPassword);
				if (loginApp != null) {
					loginApp.setLoginPwd(loginPassword);
				}
			}
			// 增加 如果入参有支付密码 则设置支付密码
			final UcfCard ucfCard = loginService.queryUcfCardByUserId(updatebase_platformInfoRequestBO.getUserId());
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getPayPassword()) && ucfCard != null) {
				String payPassword = Cryptos.encrypt(updatebase_platformInfoRequestBO.getPayPassword().trim(), user.getUserId());
				ucfCard.setPaymentPassword(payPassword);
			}
			userinfo.setGmtLastModified(new Date());
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLegalPersonName())) {
				ucfOrg.setCoperation(updatebase_platformInfoRequestBO.getLegalPersonName());
				ucfOrg.setLegalPerson(updatebase_platformInfoRequestBO.getLegalPersonName());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getAgentPersonName())) {
				ucfOrg.setAgentName(updatebase_platformInfoRequestBO.getAgentPersonName());// 代理人姓名
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getAgentPersonNo())) {
				ucfOrg.setAgentCard(updatebase_platformInfoRequestBO.getAgentPersonNo());// 代理人号码
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLegalPersonNo())) {
				ucfOrg.setCoperationCard(updatebase_platformInfoRequestBO.getLegalPersonNo());
				ucfOrg.setLegalIdentity(updatebase_platformInfoRequestBO.getLegalPersonNo());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEnterprisePhone())) {
				ucfOrg.setCell(updatebase_platformInfoRequestBO.getEnterprisePhone());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getFax())) {
				ucfOrg.setFax(updatebase_platformInfoRequestBO.getFax());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getProvinces())) {
				ucfOrg.setProvince(updatebase_platformInfoRequestBO.getProvinces());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getCity())) {
				ucfOrg.setCity(updatebase_platformInfoRequestBO.getCity());
			}

			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEndDate())) {
				ucfOrg.setCharetExpire(DateUtil.formatStringToDate(updatebase_platformInfoRequestBO.getEndDate(), "yyyyMMdd"));
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLicenseCopy())) {
				ucfOrg.setLicenseCopy(updatebase_platformInfoRequestBO.getLicenseCopy());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getOrgCertificate())) {
				ucfOrg.setOrgCertificate(updatebase_platformInfoRequestBO.getOrgCertificate());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getTaxCertificate())) {
				ucfOrg.setTaxCertificate(updatebase_platformInfoRequestBO.getTaxCertificate());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLegalIdentityCopy())) {
				ucfOrg.setLegalIdentityCop(updatebase_platformInfoRequestBO.getLegalIdentityCopy());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getLegalIdentityType())) {
				ucfOrg.setLegalIdentityType(updatebase_platformInfoRequestBO.getLegalIdentityType());
			}
			if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getEmail())) {
				userinfo.setEmail(updatebase_platformInfoRequestBO.getEmail());
				if (loginApp != null) {
					loginApp.setEmail(updatebase_platformInfoRequestBO.getEmail());
					loginApp.setLoginId(updatebase_platformInfoRequestBO.getEmail());
				}
				ucfOrg.setEmail(updatebase_platformInfoRequestBO.getEmail());
			}
			ucfOrg.setGmtModified(new Date());
			//修改商户补充属性信息
			final UcfMerchantExtra ucfMerchantExtra = ucfMerchantExtraService.queryUcfMerchantExtraById(userinfo.getUserId());
			if(ucfMerchantExtra!=null){
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getMerchantType())){
					ucfMerchantExtra.setMerchantType(updatebase_platformInfoRequestBO.getMerchantType());
					if(EnumMerchantExtra.ORDINARY_MERCHANT.getCode().equals(updatebase_platformInfoRequestBO.getMerchantType())){
						ucfMerchantExtra.setAccountType("");
						ucfMerchantExtra.setParentUserId("");
					}
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getAccountType())){
					ucfMerchantExtra.setAccountType(updatebase_platformInfoRequestBO.getAccountType());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getParentUserId())){
					ucfMerchantExtra.setParentUserId(updatebase_platformInfoRequestBO.getParentUserId());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getFirstBusinessCode())){
					ucfMerchantExtra.setFirstBusinessCode(updatebase_platformInfoRequestBO.getFirstBusinessCode());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getFirstBusinessName())){
					ucfMerchantExtra.setFirstBusinessName(updatebase_platformInfoRequestBO.getFirstBusinessName());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getSecondBusinessCode())){
					ucfMerchantExtra.setSecondBusinessCode(updatebase_platformInfoRequestBO.getSecondBusinessCode());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getSecondBusinessName())){
					ucfMerchantExtra.setSecondBusinessName(updatebase_platformInfoRequestBO.getSecondBusinessName());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getProductCode())){
					ucfMerchantExtra.setProductCode(updatebase_platformInfoRequestBO.getProductCode());
				}
				if(org.apache.commons.lang.StringUtils.isNotEmpty(updatebase_platformInfoRequestBO.getProductName())){
					ucfMerchantExtra.setProductName(updatebase_platformInfoRequestBO.getProductName());
				}
			}
			UcfBankCard queryUcfBankCard = new UcfBankCard();
			queryUcfBankCard.setUserId(updatebase_platformInfoRequestBO.getUserId());
			final UcfBankCard bankCard = ucfBankCardDao.queryUcfBankCard(queryUcfBankCard);
			boolean commit = (Boolean) transactionTemplate.execute(new TransactionCallback<Object>() {
				public Object doInTransaction(final TransactionStatus status) {
					try {
						loginService.updateUcfUser(userinfo);
						ucfOrgDao.updateUcfOrg(ucfOrg);
						loginService.updateUcfCustomer(customer);
						if (ucfCard != null) {
							loginService.updateUcfCard(ucfCard);
						}
						if (ucfMerchantExtra != null) {
							ucfMerchantExtraService.updateUcfMerchantExtra(ucfMerchantExtra);
						}
						if (loginApp != null) {
							loginService.updateUcfUserApp(loginApp);
						}
						if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankCardNo())) {
							if (bankCard == null) {
								UcfBankCard add = addBankCard(updatebase_platformInfoRequestBO);
								ucfBankCardDao.insertUcfBankCard(add);
							} else {
								updateBankCard(bankCard, updatebase_platformInfoRequestBO);
								ucfBankCardDao.updateUcfBankCard(bankCard);
							}
						}
					} catch (final Exception e) {
						LOGGER.error(e.getMessage(), e);
						status.setRollbackOnly();
						return false;
					}
					return true;
				}
			});
			if (commit) {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
				updatebase_platformInfoResultBO.setUserId(userinfo.getUserId());
				return updatebase_platformInfoResultBO;
			} else {
				updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
				updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
				updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
				return updatebase_platformInfoResultBO;
			}
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			updatebase_platformInfoResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			updatebase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			updatebase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return updatebase_platformInfoResultBO;
		}
	}

	private UcfBankCard addBankCard(Updatebase_platformInfoRequestBO updatebase_platformInfoRequestBO) throws AccountException {
		final UcfBankCard insertBankCard = new UcfBankCard();
		SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd");
		StringBuffer bankCardId = new StringBuffer();
		bankCardId.append(sdf.format(new Date()));
		bankCardId.append(ucfBankCardDao.getBankCardSeq());
		insertBankCard.setId(bankCardId.toString());
		insertBankCard.setUserId(updatebase_platformInfoRequestBO.getUserId());
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankName())) {
			insertBankCard.setBankName(updatebase_platformInfoRequestBO.getBankName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankCode())) {
			insertBankCard.setBankId(updatebase_platformInfoRequestBO.getBankCode());
		}
		insertBankCard.setCardNo(updatebase_platformInfoRequestBO.getBankCardNo());
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankCardName())) {
			insertBankCard.setCardName(updatebase_platformInfoRequestBO.getBankCardName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getIssuerName())) {
			insertBankCard.setBranchname(updatebase_platformInfoRequestBO.getIssuerName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getIssuer())) {
			insertBankCard.setIssuer(updatebase_platformInfoRequestBO.getIssuer());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getCity())) {
			insertBankCard.setCity(updatebase_platformInfoRequestBO.getCity());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getProvinces())) {
			insertBankCard.setProvince(updatebase_platformInfoRequestBO.getProvinces());
		}
		insertBankCard.setCardType(EnumBankCardType.BUSINESS_ACCOUNT.getCode());
		insertBankCard.setCertFrom("system");
		insertBankCard.setRegisterFrom("system");
		insertBankCard.setConfirmStatus(EnumConfirmStatus.CONFIRM_YES.getCode());
		insertBankCard.setStatus(EnumBindBankCardStatus.SUCCESS.getCode());
		insertBankCard.setUnionSeq(ucfBankCardDao.getUnionSeq());
		return insertBankCard;
	}

	private void updateBankCard(final UcfBankCard updateBankCard, Updatebase_platformInfoRequestBO updatebase_platformInfoRequestBO) {
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankName())) {
			updateBankCard.setBankName(updatebase_platformInfoRequestBO.getBankName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankCode())) {
			updateBankCard.setBankId(updatebase_platformInfoRequestBO.getBankCode());
		}
		updateBankCard.setCardNo(updatebase_platformInfoRequestBO.getBankCardNo());
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getBankCardName())) {
			updateBankCard.setCardName(updatebase_platformInfoRequestBO.getBankCardName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getIssuerName())) {
			updateBankCard.setBranchname(updatebase_platformInfoRequestBO.getIssuerName());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getIssuer())) {
			updateBankCard.setIssuer(updatebase_platformInfoRequestBO.getIssuer());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getCity())) {
			updateBankCard.setCity(updatebase_platformInfoRequestBO.getCity());
		}
		if (!StringUtil.isEmpty(updatebase_platformInfoRequestBO.getProvinces())) {
			updateBankCard.setProvince(updatebase_platformInfoRequestBO.getProvinces());
		}
	}

	@Override
	public Enterprisebase_platformInfoResultBO queryEnterprisebase_platform(String merchantId, String userId) {
		LOGGER.info("查询企业会员审核状态：merchantId[" + merchantId + "] userId[" + userId + "] ");
		Enterprisebase_platformInfoResultBO selectbase_platformInfoResultBO = new Enterprisebase_platformInfoResultBO();
		if (StringUtil.isEmpty(merchantId)) {
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getMsgS());
			return selectbase_platformInfoResultBO;
		}
		if (StringUtil.isEmpty(userId)) {
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			return selectbase_platformInfoResultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(userId);
		user.setRefMerchant(merchantId);
		try {
			user = this.loginService.queryUcfUserInfo(user);
			if (user == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			List<UcfBankCard> bankCardList = loginService.queryUcfBankCardByUserId(user.getUserId());
			if (bankCardList.isEmpty()) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_BANKCARD_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_BANKCARD_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			UcfBankCard bankCard = bankCardList.get(0);
			final UcfOrg ucfOrg = ucfOrgDao.quertUcfByUserId(user.getUserId());
			if (ucfOrg == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			UcfMerchantExtra ucfMerchantExtra = ucfMerchantExtraService.queryUcfMerchantExtraById(userId);
			if (ucfMerchantExtra == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			selectbase_platformInfoResultBO.setEnterpriseFullName(ucfOrg.getCompanyFullName());
			selectbase_platformInfoResultBO.setEnterpriseShortName(ucfOrg.getCompanyName());
			selectbase_platformInfoResultBO.setBusinessLicense(ucfOrg.getCharetNo());
			selectbase_platformInfoResultBO.setEndDate(DateUtil.formatDateToString(ucfOrg.getCharetExpire(), "yyyyMMdd"));
			
			selectbase_platformInfoResultBO.setLegalPersonName(ucfOrg.getLegalPerson());
			selectbase_platformInfoResultBO.setLegalPersonNo(ucfOrg.getLegalIdentity());
			selectbase_platformInfoResultBO.setEnterpriseAddress(ucfOrg.getCompanyAdd());
			selectbase_platformInfoResultBO.setEnterprisePhone(ucfOrg.getCell());
			
			selectbase_platformInfoResultBO.setBankName(bankCard.getBankName());
			selectbase_platformInfoResultBO.setBankCode(bankCard.getBankId());
			selectbase_platformInfoResultBO.setBankCardNo(bankCard.getCardNo());
			selectbase_platformInfoResultBO.setProvinces(ucfOrg.getProvince());
			
			selectbase_platformInfoResultBO.setCity(ucfOrg.getCity());
			selectbase_platformInfoResultBO.setIssuerName(ucfOrg.getBranchName());
			selectbase_platformInfoResultBO.setIssuer(bankCard.getIssuer());
			selectbase_platformInfoResultBO.setBankCardName(bankCard.getCardName());
			// add by gaoxiang 增加代理人信息
			selectbase_platformInfoResultBO.setAgentPersonName(ucfOrg.getAgentName());
			selectbase_platformInfoResultBO.setAgentPersonNo(ucfOrg.getAgentCard());
			selectbase_platformInfoResultBO.setAgentPersonPhone(user.getCell());
			selectbase_platformInfoResultBO.setMerchantType(ucfMerchantExtra.getMerchantType());
			selectbase_platformInfoResultBO.setAccountType(ucfMerchantExtra.getAccountType());
			selectbase_platformInfoResultBO.setParentUserId(ucfMerchantExtra.getParentUserId());
			
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
			return selectbase_platformInfoResultBO;
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return selectbase_platformInfoResultBO;
		}
	}
	
	@Override
	public Enterprisebase_platformInfoResultBO queryMerchantInfo(String userId) {
		LOGGER.info("查询商户信息 userId[" + userId + "] ");
		Enterprisebase_platformInfoResultBO selectbase_platformInfoResultBO = new Enterprisebase_platformInfoResultBO();
		if (StringUtil.isEmpty(userId)) {
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			return selectbase_platformInfoResultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(userId);
		try {
			user = this.loginService.queryUcfUserInfo(user);
			if (user == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			final UcfOrg ucfOrg = ucfOrgDao.quertUcfByUserId(user.getUserId());
			if (ucfOrg == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			List<UcfBankCard> bankCardList = loginService.queryUcfBankCardByUserId(user.getUserId());
			if (bankCardList.isEmpty()) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_BANKCARD_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_BANKCARD_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			UcfBankCard bankCard = bankCardList.get(0);
			UcfMerchantExtra ucfMerchantExtra = ucfMerchantExtraService.queryUcfMerchantExtraById(userId);
			if (ucfMerchantExtra == null) {
				selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return selectbase_platformInfoResultBO;
			}
			selectbase_platformInfoResultBO.setEnterpriseFullName(ucfOrg.getCompanyFullName());
			selectbase_platformInfoResultBO.setEnterpriseShortName(ucfOrg.getCompanyName());
			selectbase_platformInfoResultBO.setOrgId(ucfOrg.getId());
			selectbase_platformInfoResultBO.setBusinessLicense(ucfOrg.getCharetNo());
			selectbase_platformInfoResultBO.setEndDate(DateUtil.formatDateToString(ucfOrg.getCharetExpire(), "yyyyMMdd"));
			selectbase_platformInfoResultBO.setLegalIdentityType(ucfOrg.getLegalIdentityType());
			selectbase_platformInfoResultBO.setLegalPersonName(ucfOrg.getLegalPerson());
			selectbase_platformInfoResultBO.setLegalPersonNo(ucfOrg.getLegalIdentity());
			selectbase_platformInfoResultBO.setEnterpriseAddress(ucfOrg.getCompanyAdd());
			selectbase_platformInfoResultBO.setEnterprisePhone(ucfOrg.getCell());
			selectbase_platformInfoResultBO.setProvinces(ucfOrg.getProvince());
			selectbase_platformInfoResultBO.setFax(ucfOrg.getFax());
			selectbase_platformInfoResultBO.setCity(ucfOrg.getCity());
			selectbase_platformInfoResultBO.setEnterpriseUrl(ucfOrg.getMallUrl());
			selectbase_platformInfoResultBO.setIssuerName(bankCard.getBranchname());
			selectbase_platformInfoResultBO.setZipCode(ucfOrg.getZip());
			selectbase_platformInfoResultBO.setAgentPersonName(ucfOrg.getAgentName());
			selectbase_platformInfoResultBO.setAgentPersonNo(ucfOrg.getAgentCard());
			selectbase_platformInfoResultBO.setAgentPersonPhone(user.getPhone());
			selectbase_platformInfoResultBO.setEmail(user.getEmail());
			selectbase_platformInfoResultBO.setEnabledStatus(user.getEnabledStatus());
			//商户拓展属性
			selectbase_platformInfoResultBO.setMerchantType(ucfMerchantExtra.getMerchantType());
			selectbase_platformInfoResultBO.setAccountType(ucfMerchantExtra.getAccountType());
			selectbase_platformInfoResultBO.setParentUserId(ucfMerchantExtra.getParentUserId());
			selectbase_platformInfoResultBO.setFirstBusinessCode(ucfMerchantExtra.getFirstBusinessCode());
			selectbase_platformInfoResultBO.setFirstBusinessName(ucfMerchantExtra.getFirstBusinessName());
			selectbase_platformInfoResultBO.setSecondBusinessCode(ucfMerchantExtra.getSecondBusinessCode());
			selectbase_platformInfoResultBO.setSecondBusinessName(ucfMerchantExtra.getSecondBusinessName());
			selectbase_platformInfoResultBO.setProductCode(ucfMerchantExtra.getProductCode());
			selectbase_platformInfoResultBO.setProductName(ucfMerchantExtra.getProductName());
			//银行卡信息
			selectbase_platformInfoResultBO.setBankName(bankCard.getBankName());
			selectbase_platformInfoResultBO.setBankCode(bankCard.getBankId());
			selectbase_platformInfoResultBO.setBankCardNo(bankCard.getCardNo());
			selectbase_platformInfoResultBO.setBankCardName(bankCard.getCardName());
			selectbase_platformInfoResultBO.setIssuer(bankCard.getIssuer());
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
			return selectbase_platformInfoResultBO;
		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			selectbase_platformInfoResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			selectbase_platformInfoResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			return selectbase_platformInfoResultBO;
		}
	}

	@Override
	public EnterpriseStatusReturnValueBo queryEnterprisebase_platformStatus(String merchantId, String userId, String userType) {
		LOGGER.info("查询企业会员审核状态：merchantId[" + merchantId + "] userId[" + userId + "] userType [" + userType + "]");
		EnterpriseStatusReturnValueBo resultBO = new EnterpriseStatusReturnValueBo();
		if (merchantId == null || "".equals(merchantId)) {
			resultBO.setRespCode(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			resultBO.setRespMsg(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getMsgS());
			resultBO.setStatus(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			return resultBO;
		}
		if (userId == null || "".equals(userId)) {
			resultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			resultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			resultBO.setStatus(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			return resultBO;
		}
		if (userType == null || "".equals(userType)) {
			resultBO.setRespCode(Enumbase_platformCode.USER_TYPE_NO_NULL.getCode());
			resultBO.setRespMsg(Enumbase_platformCode.USER_TYPE_NO_NULL.getMsgS());
			resultBO.setStatus(Enumbase_platformCode.USER_TYPE_NO_NULL.getCode());
			return resultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(userId);
		user.setRefMerchant(merchantId);
		user.setUserType(BigDecimal.valueOf(Integer.valueOf(userType)));
		try {
			user = this.loginService.queryUcfUserInfo(user);
			if (user == null) {
				resultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				resultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				resultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				return resultBO;
			}
			resultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			if (user.getEnabledStatus().equals(EnumUserEnabledStatus.W.getCode()) || user.getEnabledStatus().equals(EnumUserEnabledStatus.Q.getCode())) {
				resultBO.setStatus("99");
			} else if (user.getEnabledStatus().equals(EnumUserEnabledStatus.T.getCode())) {
				resultBO.setStatus("00");
			} else {
				resultBO.setStatus("01");
			}
			return resultBO;

		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			resultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			resultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			resultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			return resultBO;
		}
	}

	@Override
	public base_platformReviewResultBO base_platformReview(base_platformReviewRequestBO base_platformReviewRequestBO) {
		base_platformReviewResultBO base_platformReviewResultBO = new base_platformReviewResultBO();

		if (base_platformReviewRequestBO.getMerchantId() == null || "".equals(base_platformReviewRequestBO.getMerchantId())) {
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.MERCHANT_ID_NOT_NULL.getCode());
			return base_platformReviewResultBO;
		}
		if (base_platformReviewRequestBO.getUserId() == null || "".equals(base_platformReviewRequestBO.getUserId())) {
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.USER_ID_NOT_NULL.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.USER_ID_NOT_NULL.getCode());
			return base_platformReviewResultBO;
		}
		if (base_platformReviewRequestBO.getUserType() == null || "".equals(base_platformReviewRequestBO.getUserType())) {
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.USER_TYPE_NO_NULL.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.USER_TYPE_NO_NULL.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.USER_TYPE_NO_NULL.getCode());
			return base_platformReviewResultBO;
		}
		if (base_platformReviewRequestBO.getReviewType() == null || "".equals(base_platformReviewRequestBO.getReviewType())) {
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.REVIEW_TYPE_NO_NULL.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.REVIEW_TYPE_NO_NULL.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.REVIEW_TYPE_NO_NULL.getCode());
			return base_platformReviewResultBO;
		}
		UcfUser user = new UcfUser();
		user.setUserId(base_platformReviewRequestBO.getUserId());
		user.setRefMerchant(base_platformReviewRequestBO.getMerchantId());
		user.setUserType(BigDecimal.valueOf(Integer.valueOf(base_platformReviewRequestBO.getUserType())));
		try {
			user = this.loginService.queryUcfUserInfo(user);
			if (user == null) {
				base_platformReviewResultBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				base_platformReviewResultBO.setStatus(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				return base_platformReviewResultBO;
			}
			user.setEnabledStatus("T");// T：正常
			userRegService.updateUserInfo(user);
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
			return base_platformReviewResultBO;

		} catch (Exception e) {
			LOGGER.error(e.getMessage(), e);
			base_platformReviewResultBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			base_platformReviewResultBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
			base_platformReviewResultBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			return base_platformReviewResultBO;
		}
	}

	@Override
	public VerifyEmailResultBO VerifyEmail(VerifyEmailRequestBO verifyEmailRequestBO) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public BaseBO auditEnterprisebase_platform(String userId, String status) {
		BaseBO bo = new BaseBO();
		try {
			UcfUser ucfUser = new UcfUser();
			ucfUser.setUserId(userId);
			ucfUser.setUserType(BigDecimal.valueOf(Integer.valueOf(EnumUserType.ENTERPRISE.getCode())));
			List<UcfUser> users = ucfUserDao.queryUcfUserListByWhere(ucfUser);
			if (users == null || users.size() == 0) {
				bo.setRespCode(Enumbase_platformCode.NO_EXIST_USER.getCode());
				bo.setStatus(Enumbase_platformCode.NO_EXIST_USER.getCode());
				bo.setRespMsg(Enumbase_platformCode.NO_EXIST_USER.getMsgS());
				return bo;
			}
			UcfUser user = users.get(0);
			if (Constants.STATUS_SUC.equals(status)) {
				user.setEnabledStatus(EnumUserEnabledStatus.T.getCode());
				user.setRealnameStatus(Constants.REALNAME_STATUS_YES);
				ucfUserDao.updateUcfUser(user);
			}
			// 发送mq消息通知p2p
			HashMap<String, String> params = new HashMap<String, String>();
			params.put("merchantId", user.getRefMerchant());
			params.put("p2pUserId", user.getRefUser());
			params.put("userId", user.getUserId());
			params.put("status", status);
			params.put("callBackUrl", "");

			UcfSendMessage mqmsg = new UcfSendMessage();
			mqmsg.setBizValue(params);
			SendResult rocketResult = ucfMQProducer.sendMessage(RocketMQTopicEnum.ROCKETMQ_base_platform_CORP_P2P_TOPICANDTAG.getTopic(), RocketMQTopicEnum.ROCKETMQ_base_platform_CORP_P2P_TOPICANDTAG.getTag(), mqmsg);
			LOGGER.info("【企业会员审核】发送RocketMQ消息成功：" + rocketResult.toString());
			bo.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			bo.setStatus(Enumbase_platformCode.SUCCESS.getCode());
			bo.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
		} catch (Exception e) {
			LOGGER.error("【企业会员审核】:", e);
			bo.setRespCode(Enumbase_platformCode.ERROR.getCode());
			bo.setStatus(Enumbase_platformCode.ERROR.getCode());
			bo.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
		}
		return bo;
	}

	@Override
	public PageEnterprisebase_platformResultBo searchEnterprisebase_platforms(Enterprisebase_platformSearchReqBo searchBo) {

		return null;
	}

	@Override
	public Enterprisebase_platformBankCardBO queryEnterprisebase_platformBankCard(String merchantId, String userId) {
		Enterprisebase_platformBankCardBO enterprisebase_platformBankCardBO = new Enterprisebase_platformBankCardBO();
		try {
			if (userId == null || "".equals(userId) || merchantId == null || "".equals(merchantId)) {
				enterprisebase_platformBankCardBO.setRespCode(Enumbase_platformCode.PARAM_ERROR.getCode());
				enterprisebase_platformBankCardBO.setRespMsg(Enumbase_platformCode.PARAM_ERROR.getMsgS());
				enterprisebase_platformBankCardBO.setStatus(Enumbase_platformCode.PARAM_ERROR.getCode());
				return enterprisebase_platformBankCardBO;
			}
			UcfUser user = new UcfUser();
			user.setUserId(userId);
			user = this.loginService.queryUcfUserInfo(user);
			if (user == null) {
				enterprisebase_platformBankCardBO.setRespCode(Enumbase_platformCode.MERCHANT_NO_EXIST.getCode());
				enterprisebase_platformBankCardBO.setRespMsg(Enumbase_platformCode.MERCHANT_NO_EXIST.getMsgS());
				return enterprisebase_platformBankCardBO;
			}

			List<UcfBankCard> bankCardList = this.loginService.queryUcfBankCardByUserId(userId);
			if (bankCardList.isEmpty()) {
				enterprisebase_platformBankCardBO.setRespCode(Enumbase_platformCode.base_platform_NOT_HAVE_BANKCARD.getCode());
				enterprisebase_platformBankCardBO.setRespMsg(Enumbase_platformCode.base_platform_NOT_HAVE_BANKCARD.getMsgS());
				return enterprisebase_platformBankCardBO;
			}
			UcfBankCard bankCard = bankCardList.get(0);
			enterprisebase_platformBankCardBO.setBankCardNo(bankCard.getCardNo());
			enterprisebase_platformBankCardBO.setBankCardName(bankCard.getCardName());
			enterprisebase_platformBankCardBO.setBankName(bankCard.getBankName());
			enterprisebase_platformBankCardBO.setBankCode(bankCard.getBankId());
			enterprisebase_platformBankCardBO.setCartType(bankCard.getCardType());
			enterprisebase_platformBankCardBO.setBranchName(bankCard.getBranchname());
			enterprisebase_platformBankCardBO.setIssuer(bankCard.getIssuer());
			enterprisebase_platformBankCardBO.setCity(bankCard.getCity());
			enterprisebase_platformBankCardBO.setProvince(bankCard.getProvince());
			enterprisebase_platformBankCardBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
			enterprisebase_platformBankCardBO.setStatus(Enumbase_platformCode.SUCCESS.getCode());
			enterprisebase_platformBankCardBO.setRespMsg(Enumbase_platformCode.SUCCESS.getMsgS());
			return enterprisebase_platformBankCardBO;
		} catch (Exception e) {
			LOGGER.error("【查询企业会员银行卡信息】:", e);
			enterprisebase_platformBankCardBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			enterprisebase_platformBankCardBO.setStatus(Enumbase_platformCode.ERROR.getCode());
			enterprisebase_platformBankCardBO.setRespMsg(Enumbase_platformCode.ERROR.getMsgS());
		}
		return enterprisebase_platformBankCardBO;
	}
	
	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO)
	public MainAccountListBO queryMainAccountList(){
		MainAccountListBO mainAccountListBO = new MainAccountListBO();
		List<UcfUser> userList = null;
		try {
			userList = ucfMerchantExtraService.queryMainAccountList();
			if(userList!=null && userList.size()>0){
				List<com.ucf.customer.ws.bo.UcfUser> mainAccountList = new ArrayList<com.ucf.customer.ws.bo.UcfUser>();
				for(UcfUser ucfUser : userList){
					com.ucf.customer.ws.bo.UcfUser mainAccount = new com.ucf.customer.ws.bo.UcfUser();
					BeanUtilEx.copyProperties(mainAccount, ucfUser);
					mainAccountList.add(mainAccount);
				}
				mainAccountListBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				mainAccountListBO.setRespMsg("成功");
				mainAccountListBO.setUserlist(mainAccountList);
			}else{
				mainAccountListBO.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
				mainAccountListBO.setRespMsg("未找到主账户");
			}
		} catch (Exception e) {
			LOGGER.error(e.getMessage(),e);
			mainAccountListBO.setRespCode(Enumbase_platformCode.ERROR.getCode());
			mainAccountListBO.setRespMsg("系统异常");
		}
		return mainAccountListBO;
	}
	
	@Override
	@DigestLogAnnotated(digestIdentificationCode = "1006", logFileName = "DEFAULT.DIG", loggerLevel = LoggerLevel.INFO, isSensitiveInfo=true)
	public GroupAccountBo queryGroupAccount(String childUserId) {
		GroupAccountBo groupAccountBo = new GroupAccountBo();
		if(StringUtils.isEmpty(childUserId)){
			groupAccountBo.setRespCode(Enumbase_platformCode.ERROR.getCode());
			groupAccountBo.setRespMsg("子商户ID为空");
		}else{
			try {
				UcfMerchantExtra ucfMerchantExtraChild = ucfMerchantExtraService.queryUcfMerchantExtraById(childUserId);
				if(ucfMerchantExtraChild!=null){
					UcfUser ucfUserParent = loginService.queryUserInfo(ucfMerchantExtraChild.getParentUserId());
					UcfCard ucfCardParent = loginService.queryUcfCardByUserId(ucfMerchantExtraChild.getParentUserId());
					if(ucfUserParent!=null){
						//查询子商户、账户信息
						UcfUser ucfUserChild = loginService.queryUserInfo(childUserId);
						UcfCard ucfCardChild = loginService.queryUcfCardByUserId(childUserId);
						
						groupAccountBo.setChildMerchantId(ucfUserChild.getUserId());
						groupAccountBo.setChildMerchantName(ucfUserChild.getRealName());
						groupAccountBo.setChildAccountNo(ucfCardChild.getAccountId());
						
						groupAccountBo.setParentMerchantId(ucfUserParent.getUserId());
						groupAccountBo.setParentMerchantName(ucfUserParent.getRealName());
						groupAccountBo.setParentAccountNo(ucfCardParent.getAccountId());
						
						groupAccountBo.setRespCode(Enumbase_platformCode.SUCCESS.getCode());
						groupAccountBo.setRespMsg("成功");
					}else{
						groupAccountBo.setRespCode(Enumbase_platformCode.ERROR.getCode());
						groupAccountBo.setRespMsg("未找到用户["+childUserId+"]的集团主商户");
					}
				}else{
					groupAccountBo.setRespCode(Enumbase_platformCode.ERROR.getCode());
					groupAccountBo.setRespMsg("用户["+childUserId+"]不存在");
				}
			} catch (Exception e) {
				LOGGER.error("查询商户["+childUserId+"]信息异常",e);
				groupAccountBo.setRespCode(Enumbase_platformCode.ERROR.getCode());
				groupAccountBo.setRespMsg("系统异常");
			}
		}
		return groupAccountBo;
	}
	
}