<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>先锋支付--会员中心</title>
<jsp:include page="/WEB-INF/views/jsp/common/common.jsp"/>
<link href="${staticbase_platformPath}/css/bootstrap.css" rel="stylesheet"/>
</head>
<title>先锋支付-交易记录</title>
<script type="text/javascript">
	Date.prototype.pattern=function(fmt) {        
	    var o = {        
	    "M+" : this.getMonth()+1, //月份        
	    "d+" : this.getDate(), //日        
	    "h+" : this.getHours()%12 == 0 ? 12 : this.getHours()%12, //小时        
	    "H+" : this.getHours(), //小时        
	    "m+" : this.getMinutes(), //分        
	    "s+" : this.getSeconds(), //秒        
	    "q+" : Math.floor((this.getMonth()+3)/3), //季度        
	    "S" : this.getMilliseconds() //毫秒        
	    };        
	    var week = {        
	    "0" : "/u65e5",        
	    "1" : "/u4e00",        
	    "2" : "/u4e8c",        
	    "3" : "/u4e09",        
	    "4" : "/u56db",        
	    "5" : "/u4e94",        
	    "6" : "/u516d"       
	    };        
	    if(/(y+)/.test(fmt)){        
	        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));        
	    }        
	    if(/(E+)/.test(fmt)){        
	        fmt=fmt.replace(RegExp.$1, ((RegExp.$1.length>1) ? (RegExp.$1.length>2 ? "/u661f/u671f" : "/u5468") : "")+week[this.getDay()+""]);        
	    }        
	    for(var k in o){        
	        if(new RegExp("("+ k +")").test(fmt)){        
	            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));        
	        }        
	    }        
	    return fmt;        
	}

	function queryTradeInfo(starDate,endDate,tradeType,tradeStatus){
		if(starDate!=null){
			document.getElementById("queryType").value=starDate;
			var queryType = $('input[name=queryType]').val();
			if(queryType=='today'){
				var stDate = new Date();
				stDate.setDate(stDate.getDate());
				starDate = new Date(stDate).pattern("yyyy-MM-dd");
				$("#startDate").datebox("setValue",starDate);
				$("#endDate").datebox("setValue",starDate);
			}
			if(queryType=='1M'){
				var stDate = new Date();
				$("#endDate").datebox("setValue",new Date(stDate).pattern("yyyy-MM-dd"));
				stDate.setMonth(stDate.getMonth()-1);
				starDate = new Date(stDate).pattern("yyyy-MM-dd");
				$("#startDate").datebox("setValue",starDate);
			}
			if(queryType=='3M'){
				var stDate = new Date();
				$("#endDate").datebox("setValue",new Date(stDate).pattern("yyyy-MM-dd"));
				stDate.setMonth(stDate.getMonth()-3);
				starDate = new Date(stDate).pattern("yyyy-MM-dd");
				$("#startDate").datebox("setValue",starDate);
			}
			if(queryType=='1Y'){
				var stDate = new Date();
				$("#endDate").datebox("setValue",new Date(stDate).pattern("yyyy-MM-dd"));
				stDate.setYear(stDate.getFullYear()-1);
				starDate = new Date(stDate).pattern("yyyy-MM-dd");
				$("#startDate").datebox("setValue",starDate);
			}
			if(queryType=='other'){
				var stDate = new Date();
				stDate.setYear(stDate.getFullYear()-1);
				starDate = new Date(stDate).pattern("yyyy-MM-dd");
				$("#startDate").datebox("setValue","");
				$("#endDate").datebox("setValue",starDate);
			}
		}
		
		var startDate = $('input[name=startDate]').val();
		var endDate = $('input[name=endDate]').val();
		if(queryType=='other'){
			if(endDate==null || endDate=="" ){
				alert("结束时间都不能为空！");
				return false;
			}
		}else{
			if(startDate==null || startDate=="" || endDate==null || endDate=="" ){
				alert("开始时间、结束时间都不能为空！");
				return false;
			}
		}
		
		var reg = /^(\d{4})-(0\d{1}|1[0-2])-(0\d{1}|[12]\d{1}|3[01])$/; 
		if(queryType=='other'){
			if(endDate.match(reg) == null) {
				alert("日期格式错误！");
				return false;
			}
		}else{
			if(startDate.match(reg) == null || endDate.match(reg) == null) {
				alert("日期格式错误！");
				return false;
			}
		}
		
		var start =  new Date(startDate.replace(/-/g,"/"));
		var end =  new Date(endDate.replace(/-/g,"/"));
		if(queryType!='other' && start > end){
			alert("开始时间不能超过结束时间！");
			return false;
		}
		if(tradeType!=null){
			document.getElementById("tradeType").value=tradeType;
		}
		if(tradeStatus!=null){
			document.getElementById("tradeStatus").value=tradeStatus;
		}
		var loadPage=document.loadPage
		loadPage.submit();
	}
	var showedDetail=null;
	function showDetail(index){
		showedDetail?showedDetail.hide():"";
		showedDetail=$("#detail"+index).show();
		showedDetail.on("mouseleave",hideDetail);
    }

	function hideDetail(t){
  	  if(showedDetail){
      	  showedDetail.hide();
      	  showedDetail.off("mouseleave",hideDetail);
  	  }
    }
    function showDetails(index){
		$("#details"+index).show(); 
    }
    function hideDetails(index){
    	$("#details"+index).hide();
    }
	$(function(){
		$("#startDate").datebox({
			onSelect:function(date){
				queryTradeInfo(null,null,null,null);
			}
		});
		$("#endDate").datebox({
			onSelect:function(date){
				queryTradeInfo(null,null,null,null);
			}
		});
		$("#detail").mouseleave(function(){
			$(this).hide();
		});
	});
</script>
</head>
<body>
<c:set var="tab" value="3" scope="application"/>
<c:set var="tab1" value="3" scope="application"/>
<c:import url="/common/head.htm"></c:import>
	<div class="person-navigation">
		<ul class="container">
			<li class="person-navigation-active"><a href="${basePath}/trade/tradeList.htm">交易记录</a></li>
		</ul>
		<div class="clear"></div>
	</div>
	<section class="bgc-gray h-auto">
	<form action="${basePath}/trade/tradeList.htm" method="post" id="loadPage" name="loadPage">
	<div class="box">
		<div class="main add-hand">
			<div class="box_title pl20"><em class="f18">交易记录</em></div>
			<ul class="record pdt20 ml20">
				<li class="pt10">起止日期： </li>
				<li><input class="idbox" value="${startDate}" name="startDate" id="startDate" type="text"/></li>
				<li class="pt10">-</li>
				<li><input class="idbox" value="${endDate}" name="endDate" id="endDate" type="text"/></li>
				<li class="pt10 <c:if test="${queryType=='today'}">record-active</c:if>"><a onclick="queryTradeInfo('today','${endDate}',null,null);">今天</a></li>
				<li class="pt10 <c:if test="${queryType=='1M'}"> record-active</c:if>"><a onclick="queryTradeInfo('1M','${endDate}',null,null);">最近一个月</a></li>
				<li class="pt10 <c:if test="${queryType=='3M'}"> record-active</c:if>"><a onclick="queryTradeInfo('3M','${endDate}',null,null);">3个月</a></li>
				<li class="pt10 <c:if test="${queryType=='1Y'}"> record-active</c:if>"><a onclick="queryTradeInfo('1Y','${endDate}',null,null);">1年</a></li>
				<li class="pt10 <c:if test="${queryType=='other'}"> record-active </c:if>"><a onclick="queryTradeInfo('other','${endDate}',null,null);">1年前>></a></li>
				<input type="hidden" name="queryType" id="queryType" value="${queryType}"/>
			</ul>
			<ul class="record mgt10 mgb20 ml20">
				<li>交易类型：</li>
				<li <c:if test="${tradeType==null || tradeType=='' }">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,'',null);">全部</a></li>
				<li <c:if test="${tradeType=='10'}">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,'10',null);">充值</a></li>
				<li <c:if test="${tradeType=='14'}">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,'14',null);">提现</a></li>
				<li <c:if test="${tradeType=='16'}">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,'16',null);">支付</a></li>
				<input type="hidden" name="tradeType" id="tradeType" value="${tradeType}"/>
			</ul></br>
			<ul class="record pdb20 ml20">
				<li>交易状态：</li>
				<li <c:if test="${tradeStatus==null || tradeStatus=='' }">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,null,'');">全部</a></li>
				<li <c:if test="${tradeStatus=='S' }">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,null,'S');">成功</a></li>
				<li <c:if test="${tradeStatus=='F' }">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,null,'F');">失败</a></li>
				<li <c:if test="${tradeStatus=='I' }">class="record-active"</c:if>><a onclick="queryTradeInfo(null,null,null,'I');">处理中</a></li>
				<input type="hidden" name="tradeStatus" id="tradeStatus" value="${tradeStatus}"/>
			</ul></br></br>
			<table class="table table-bordered table-striped" style="font-size:14px;">
				<thead>
					<tr class="jy-gray">
						<th></th>
						<th>交易时间</th>
						<th>名称 | 交易号</th>
						<th>金额 | 明细</th>
						<th>交易状态</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<c:if test="${neter eq '0'}">
							<c:out value="<tr>" escapeXml="false"></c:out>
							<c:out value="<td>通讯异常。。。。</td>" escapeXml="false"></c:out>
							<c:out value="</tr>" escapeXml="false"></c:out>
							<c:out value="</tbody>" escapeXml="false"></c:out>
							<c:out value="</table>" escapeXml="false"></c:out>
					</c:if>
					<c:if test="${neter ne '0' }">
						<c:if test="${empty(orders)}">
							<c:out value="<tr>" escapeXml="false"></c:out>
							<c:out value="<td>交易记录为空!</td>" escapeXml="false"></c:out>
							<c:out value="</tr>" escapeXml="false"></c:out>
						</c:if>
						<c:if test="${!empty(orders)}">
							<c:forEach items="${orders}" var="item" varStatus="order">
								<tr>
									<td></td>
									<td>${fn:substring(item.date, 0, 10)}</br><span class="gry999">${fn:substring(item.date, 11, 19)}</span></td>
									<td>${item.typeName}</br><span class="gry999">${item.id}</span></td>
									<td>
										
										 <c:if test="${item.typeName=='充值'}">
				                            <a href="#"  class="detail color-green" >${item.amount}</a>
			                            </c:if>
			                            <c:if test="${item.typeName=='提现' || item.typeName=='支付'}">
				                            <a class="detail red" href="#" onmousemove="showDetail(${order.index});">${item.amount}
												<span class="jt2">
													<div id="detail${order.index}" style="display:none;text-align: center; position: absolute; width: 100px; height: 60px; top: -40px;left: -40px;">
														<div class="tan2" style="position:static;">点击查看明细</div>
														<div class="tri2" style="position:static;margin-left: 40px;margin-top: -5px;"></div>
													</div>
													<img src="${staticbase_platformPath}/images/jt2.jpg">
												</span>
											</a>
			                            </c:if>
									</td>
									<td>${item.orderStatus}</td>
									<td >
										<a class="detail" href="#" onmousemove="showDetails(${order.index});" onmouseout="hideDetails(${order.index});">详情
											<span class="jt3">
			                                    <div class="tan3 top-ch" id="details${order.index}" style="display: none;">
			                                    	<ul>
			                                        	<li>详情</li>
			                                            <li>删除</li>
			                                        </ul>
			                                    </div>
			                                    <img src="${staticbase_platformPath}/images/jt3.jpg">
											</span>
										</a>
									</td>
								</tr>
							</c:forEach>
						</c:if>
					</tbody>
				</table>
				<div>
					<jsp:include page="../customer/commons/pagefortrade.jsp" flush="true">
						<jsp:param name="formId" value="loadPage" />
					</jsp:include>
					<!-- <a style="margin-right:50px;" class="flr corner" href="#">尾页</a>
					<a href="#" class="flr corner">下一页</a>
					<span class="flr corner">共4条</span>
					<span class="flr corner">1 - 20条</span>
					<div class="clear"> -->
					<a style="margin-right:50px;" class="flr corner" href="#"></a>
					<a href="#" class="flr corner"></a>
					<span class="flr corner"></span>
					<span class="flr corner"></span>
					<div class="clear">
				</div>
			</div>
 			</c:if>
			<%-- <jsp:include page="../customer/commons/page.jsp" flush="true">
				<jsp:param name="formId" value="loadPage" />
			</jsp:include> --%>
		</div>
	</div>
</div>
</form>

</section>
<c:import url="/WEB-INF/views/jsp/common/newfooter.jsp"></c:import>
<jsp:include page="../common/resource_js.jsp"/>
</body>
</html>